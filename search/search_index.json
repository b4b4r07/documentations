{"config":{"lang":["en"],"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"","title":"Home"},{"location":"concepts/kubernetes/components/","text":"Kubernetes\u306e\u69cb\u6210\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8 # Source Kubernetes\u306e\u69cb\u6210\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306b\u3064\u3044\u3066\u4e00\u89a7\u3092\u307e\u3068\u3081\u3066\u307f\u307e\u3057\u305f\u3002Kubernetes 1.2\u6642\u70b9\u3067\u306e\u60c5\u5831\u3067\u3059\u3002 : \u5916\u90e8\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8 \u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8 \u7a2e\u5225 \u8aac\u660e etcd master Kubernetes\u306e\u30ea\u30bd\u30fc\u30b9\u306e\u6c38\u7d9a\u5316\u306b\u4f7f\u308f\u308c\u308b\u9ad8\u4fe1\u983c\u5206\u6563KVS kube-apiserver master Kubernetes\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u7ba1\u7406\u3059\u308bAPI\u30b5\u30fc\u30d0\u30fc kube-scheduler master Pod\u306e\u30ce\u30fc\u30c9\u3078\u306e\u5272\u308a\u5f53\u3066\u3092\u884c\u3046\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u30fc kube-controller-manager master Replication Controller\u306a\u3069\u306e\u5404\u7a2e\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u3092\u8d77\u52d5\u3057\u7ba1\u7406\u3059\u308b\u30de\u30cd\u30fc\u30b8\u30e3\u30fc kubelet node Pod\u3092\u8d77\u52d5\u3057\u7ba1\u7406\u3059\u308b\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8(Node\u306e\u30e1\u30a4\u30f3\u51e6\u7406) kube-proxy node Kubernetes\u306eService\u304c\u6301\u3064\u4eee\u60f3\u7684\u306aIP\u30a2\u30c9\u30ec\u30b9(cluster IP)\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3059\u308b kubectl client Kubernetes\u306eCLI\u30af\u30e9\u30a4\u30a2\u30f3\u30c8 hyperkube misc Kubernetes\u95a2\u9023\u306e\u30d0\u30a4\u30ca\u30ea\u30921\u3064\u306b\u307e\u3068\u3081\u305fall-in-one\u30d0\u30a4\u30ca\u30ea pause misc pod\u5185\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30afnamespace\u3092\u4fdd\u6301\u3059\u308b\u30b3\u30f3\u30c6\u30ca pod-master add-on High-Availability\u69cb\u6210\u6642\u306bscheduler, controller\u304c\u3069\u306eMaster\u3067\u52d5\u304f\u304b\u3092\u8abf\u6574\u3059\u308b\u30b3\u30f3\u30c6\u30ca kube-dns add-on \u30af\u30e9\u30b9\u30bf\u5185DNS\u306ePod SkyDNS add-on \u30af\u30e9\u30b9\u30bf\u5185DNS\u306eDNS\u30b5\u30fc\u30d0\u30fc kube2sky add-on SkyDNS\u306bKubernetes\u306e\u60c5\u5831\u3092\u53cd\u6620\u3055\u305b\u308b\u30d6\u30ea\u30c3\u30b8 heapster add-on Kuernetes\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u60c5\u5831\u3092\u96c6\u7d04\u3059\u308b\u4ed5\u7d44\u307f helm(Deployment Manager) add-on Kubernetes\u306e\u8a2d\u5b9a\u3092\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u5316\u3057\u30c7\u30d7\u30ed\u30a4\u3092\u7ba1\u7406\u3057\u3084\u3059\u304f\u3059\u308b\u4ed5\u7d44\u307f \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3 # Master\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8 # etcd # etcd\u306fKubernetes\u306e\u30ea\u30bd\u30fc\u30b9\u306e\u6c38\u7d9a\u5316\u306b\u4f7f\u308f\u308c\u308b\u9ad8\u4fe1\u983c\u5206\u6563KVS\u3067\u3059\u3002etcd\u306fKubernetes\u306e\u30ea\u30bd\u30fc\u30b9\u4ee5\u5916\u306b\u3082\u3001\u5f8c\u8ff0\u306eSkyDNS\u3001pod-master\u306a\u3069\u306e\u4fdd\u5b58\u306e\u7528\u9014\u306b\u3082\u4f7f\u308f\u308c\u3066\u3044\u307e\u3059(etcd\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306f\u4e00\u822c\u7684\u306b\u5225\u306b\u306a\u308a\u307e\u3059)\u3002 etcd\u306e\u30ad\u30fc\u306f\u30d1\u30b9\u5f62\u5f0f\u306b\u306a\u3063\u3066\u304a\u308a\u3001API Server\u306e --etcd-prefix \u30aa\u30d7\u30b7\u30e7\u30f3(\u30c7\u30d5\u30a9\u30eb\u30c8\u306f /registry )\u3067\u6307\u5b9a\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4ee5\u4e0b\u306b\u4fdd\u5b58\u3055\u308c\u307e\u3059\u3002\u3002\u307e\u305f --etcd-servers-overrides \u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u30ea\u30bd\u30fc\u30b9\u306e\u7a2e\u985e\u3054\u3068\u306betcd\u306e\u30b5\u30fc\u30d0\u30fc\u3092\u5909\u3048\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\u5927\u898f\u6a21\u74b0\u5883\u306b\u304a\u3044\u3066\u306fEvents\u30ea\u30bd\u30fc\u30b9\u306f\u91cf\u304c\u591a\u3044\u305f\u3081\u3001etcd\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u5225\u306b\u3059\u308b\u3053\u3068\u304c\u63a8\u5968\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u8a73\u7d30\u306fKubernetes\u30de\u30cb\u30e5\u30a2\u30eb\u306e kube-apiserver \u3068 Using Large Clusters \u306e\u9805\u3092\u53c2\u7167\u304f\u3060\u3055\u3044\u3002 etcd\u306fLinux\u30b3\u30f3\u30c6\u30ca\u5411\u3051distro\u306eCoreOS\u3092\u958b\u767a\u3059\u308b\u3001 CoreOS\u793e \u304c\u958b\u767a\u3057\u3066\u3044\u307e\u3059\u3002 \u53c2\u8003 https://github.com/coreos/etcd Kubernetes\u306eSecret\u306f\u672c\u5f53\u306b\u5b89\u5168\u304b - Qiita Kubernetes Secrets \u306e\u7d39\u4ecb \u2013 \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3084\u305d\u306e\u4ed6\u79d8\u5bc6\u60c5\u5831\u3092\u3069\u3053\u306b\u4fdd\u5b58\u3059\u308b\u304b\uff1f \u2013 \u3086\u3073\u3066\u304f \u53c2\u8003: etcd\u306b\u4fdd\u5b58\u3055\u308c\u3066\u3044\u308b\u30c7\u30fc\u30bf\u306e\u30b5\u30f3\u30d7\u30eb # Kubernetes\u30ea\u30bd\u30fc\u30b9\u306eetcd\u306e\u30ad\u30fc\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u4fdd\u5b58\u3055\u308c\u3066\u3044\u307e\u3059\u3002 # etcd\u306e \"/registry\" \u4ee5\u4e0b\u306e\u30ad\u30fc\u540d\u3092\u8868\u793a $ etcdctl ls --recursive /registry # \u30b5\u30f3\u30d7\u30eb\u3092\u629c\u7c8b /registry/namespaces/default /registry/namespaces/kube-system /registry/secrets/default/default-token-qfomx /registry/secrets/kube-system/default-token-bf0m1 /registry/minions/172.17.4.101 /registry/minions/172.17.4.201 /registry/pods/kube-system/kube-controller-manager-172.17.4.101 /registry/pods/kube-system/heapster-v10-ut5ls value\u306b\u306f\u30ea\u30bd\u30fc\u30b9\u306eJSON\u6587\u5b57\u5217\u304c\u305d\u306e\u307e\u307e\u5165\u3063\u3066\u3044\u307e\u3059\u3002 $ etcdctl get /registry/ranges/serviceips | jq . { \"kind\": \"RangeAllocation\", \"apiVersion\": \"v1\", \"metadata\": { \"creationTimestamp\": null }, \"range\": \"10.3.0.0/24\", \"data\": \"IAAACAAAAAAIAAAAAAAAAAAAAAAAAAABAAAAAAADAQ==\" } kube-apiserver # Kubernetes\u306eAPI\u30b5\u30fc\u30d0\u30fc\u3067\u3001\u4e3b\u306bKubernetes\u306e\u30ea\u30bd\u30fc\u30b9\u60c5\u5831\u306e\u7ba1\u7406\u3092\u62c5\u3063\u3066\u3044\u307e\u3059\u3002\u57fa\u672c\u7684\u306b\u30ea\u30bd\u30fc\u30b9\u60c5\u5831\u306eCRUD\u51e6\u7406\u306e\u307f\u3092\u884c\u3044\u3001\u30ea\u30bd\u30fc\u30b9\u306b\u5bfe\u3059\u308b\u5b9f\u969b\u306e\u51e6\u7406\u3084\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u306f\u5225\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8( kube-controller-manager \u3068 kube-scheduler )\u304c\u884c\u3044\u307e\u3059\u3002\u30ea\u30bd\u30fc\u30b9\u306e\u72b6\u614b\u306f\u3059\u3079\u3066etcd\u306b\u4fdd\u5b58\u3055\u308c\u307e\u3059\u3002API\u30b5\u30fc\u30d0\u30fc\u4ee5\u5916\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306f\u76f4\u63a5etcd\u3092\u53c2\u7167\u305b\u305a\u3001API\u30b5\u30fc\u30d0\u30fc\u3092\u901a\u3057\u3066\u30ea\u30bd\u30fc\u30b9\u306b\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002 kubectl \u30b3\u30de\u30f3\u30c9\u3082\u3001API\u30b5\u30fc\u30d0\u30fc\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u901a\u3057\u3066\u64cd\u4f5c\u3092\u884c\u3063\u3066\u3044\u307e\u3059\u3002 \u8a8d\u8a3c\u3001\u8a8d\u53ef\u306e\u4ed6\u306b\u3001Admission Control (\u53c2\u8003: Kubernetes: Admission Control\u3068\u306f\u4f55\u304b ) \u3068\u3044\u3046\u30ea\u30af\u30a8\u30b9\u30c8\u5236\u5fa1\u306e\u4ed5\u7d44\u307f\u3092\u5099\u3048\u3066\u3044\u307e\u3059\u3002 \u6c34\u5e73\u30b9\u30b1\u30fc\u30eb\u3055\u305b\u308b\u3053\u3068\u304c\u53ef\u80fd\u306a\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3067\u3059\u3002 \u53c2\u8003 http://kubernetes.io/docs/admin/kube-apiserver/ kube-scheduler # \u65b0\u3057\u304f\u4f5c\u3089\u308c\u305fPod\u306e\u30ce\u30fc\u30c9\u3078\u306e\u5272\u308a\u5f53\u3066\u3092\u884c\u3046\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u30fc\u3067\u3059\u3002Kubernetes API\u3092\u901a\u3057\u3066\u3001Pod, Node\u306a\u3069\u306e\u30ea\u30bd\u30fc\u30b9\u3092watch\u3057\u3001 bindings API \u3067Node\u3068Pod\u306e\u3072\u3082\u4ed8\u3051\u3092\u884c\u3044\u307e\u3059\u3002\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u306e\u30dd\u30ea\u30b7\u30fc\u306f\u8a2d\u5b9a\u53ef\u80fd\u3067\u3001 --policy-config-file \u3068\u3044\u3046\u8d77\u52d5\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u8a2d\u5b9a\u306ejson\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002(\u53c2\u8003: scheduler-policy-config.json ) \u53c2\u8003 https://github.com/kubernetes/kubernetes/blob/master/docs/devel/scheduler.md kube-controller-manager # Replication Controller\u306a\u3069\u306e\u5404\u7a2e\u30ea\u30bd\u30fc\u30b9\u306e\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u3092\u8d77\u52d5\u3059\u308b\u30de\u30cd\u30fc\u30b8\u30e3\u30fc\u3067\u3059\u3002\u5404\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u306fgoroutine\u3067\u8d77\u52d5\u3055\u308c\u307e\u3059\u3002(\u53c2\u8003: controllermanager.go#L185-L390 )\u3002\u306a\u304a\u3001Replication Controller\u306f\u30ea\u30bd\u30fc\u30b9\u540d\u81ea\u4f53\u306b\"Controller\"\u3068\u3064\u304f\u305f\u3081\u3001\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u306f\"RepplicationManager\"\u3068\u3044\u3046\u540d\u524d\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002(\u53c2\u8003: replication_controller.go#L63-L64\u306e\u30b3\u30e1\u30f3\u30c8 ) \u4e0b\u8a18\u306f kube-controller-manager \u3092pprof\u3067\u898b\u305f\u3001goroutine\u3067\u8d77\u52d5\u3059\u308b\u5404\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u306b\u95a2\u3059\u308b\u51e6\u7406\u306e\u4e00\u89a7\u3067\u3059\u3002 k8s.io/kubernetes/pkg/controller/daemon.(*DaemonSetsController).Run k8s.io/kubernetes/pkg/controller/deployment.(*DeploymentController).Run k8s.io/kubernetes/pkg/controller/endpoint.(*EndpointController).Run k8s.io/kubernetes/pkg/controller/gc.(*GCController).Run k8s.io/kubernetes/pkg/controller/job.(*JobController).Run k8s.io/kubernetes/pkg/controller/namespace.(*NamespaceController).Run k8s.io/kubernetes/pkg/controller/node.(*NodeController).Run k8s.io/kubernetes/pkg/controller/persistentvolume.(*PersistentVolumeClaimBinder).Run k8s.io/kubernetes/pkg/controller/persistentvolume.(*PersistentVolumeRecycler).Run k8s.io/kubernetes/pkg/controller/podautoscaler.(*HorizontalController).Run k8s.io/kubernetes/pkg/controller/replicaset.(*ReplicaSetController).Run k8s.io/kubernetes/pkg/controller/replication.(*ReplicationManager).Run k8s.io/kubernetes/pkg/controller/resourcequota.(*ResourceQuotaController).Run k8s.io/kubernetes/pkg/controller/serviceaccount.(*ServiceAccountsController).Run k8s.io/kubernetes/pkg/controller/serviceaccount.(*TokensController).Run \u53c2\u8003 http://kubernetes.io/docs/admin/kube-controller-manager/ Node\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8 # kubelet # kubelet\u306f\u5404\u30ce\u30fc\u30c9\u3067\u52d5\u4f5c\u3059\u308b\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3067\u3001Node\u306e\u30e1\u30a4\u30f3\u51e6\u7406\u3067\u3042\u308bPod\u306e\u8d77\u52d5\u30fb\u7ba1\u7406\u3092\u884c\u3044\u307e\u3059\u3002\u8d77\u52d5\u3059\u308bPod\u306e\u60c5\u5831\u306f\u3001API\u30b5\u30fc\u30d0\u30fc\u3092\u76e3\u8996\u3057\u3066\u81ea\u30ce\u30fc\u30c9\u306b\u5272\u308a\u5f53\u3066\u3089\u308c\u305f\u3082\u306e\u3092\u898b\u308b\u306e\u304c\u4e3b\u3067\u3059\u304c\u3001\u4ed6\u306b\u3082\u4e0b\u8a18\u306e3\u3064\u306e\u65b9\u6cd5\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u4ed5\u7d44\u307f\u3092\u4f7f\u3046\u3053\u3068\u3067API\u30b5\u30fc\u30d0\u30fc\u3092\u542b\u3080Master\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3082\u3001kubelet\u4e0a\u3067\u52d5\u4f5c\u3055\u305b\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002 \u30ed\u30fc\u30ab\u30eb\u30d5\u30a1\u30a4\u30eb \u30ce\u30fc\u30c9\u306e\u7279\u5b9a\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea(\u4f8b\u3048\u3070 /etc/kubernetes/manifests )\u3092\u76e3\u8996\u3057\u3001\u305d\u3053\u306b\u7f6e\u304b\u308c\u305f\u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u306b\u66f8\u304b\u308c\u305fPod\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\u76e3\u8996\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u307e\u305f\u306f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306f --config \u30aa\u30d7\u30b7\u30e7\u30f3\u3001\u76e3\u8996\u9593\u9694\u306f --file-check-frequency \u30aa\u30d7\u30b7\u30e7\u30f3(\u30c7\u30d5\u30a9\u30eb\u30c8\u306f20\u79d2)\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002 HTTP\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8 \u7279\u5b9a\u306eURL\u3092\u76e3\u8996\u3057\u3001\u305d\u3053\u306b\u7f6e\u304b\u308c\u305f\u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u306b\u66f8\u304b\u308c\u305fPod\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\u76e3\u8996\u3059\u308bURL\u306f --manifest-url \u30aa\u30d7\u30b7\u30e7\u30f3\u3001\u76e3\u8996\u9593\u9694\u306f --http-check-frequency= \u30aa\u30d7\u30b7\u30e7\u30f3(\u30c7\u30d5\u30a9\u30eb\u30c8\u306f20\u79d2)\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002 HTTP\u30b5\u30fc\u30d0\u30fc Kubelet\u81ea\u4f53\u6301\u3064\u306eHTTP\u30b5\u30fc\u30d0\u30fc\u306b\u5bfe\u3057\u3066\u3001\u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u3092\u9001\u4fe1\u3059\u308b\u65b9\u6cd5\u3067\u3059\u3002 \u53c2\u8003 http://kubernetes.io/docs/admin/kubelet/ kube-proxy # kube-proxy\u306f\u5404\u30ce\u30fc\u30c9\u3067\u52d5\u4f5c\u3059\u308b\u3001Service\u304c\u6301\u3064\u4eee\u60f3\u7684\u306aCluster IP\u3092\u8ee2\u9001\u3059\u308b\u305f\u3081\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30afProxy\u3067\u3059\u3002\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b9\u306f\u73fe\u72b6\u3067\u306f\u30e9\u30a6\u30f3\u30c9\u30ed\u30d3\u30f3\u306e\u307f\u304c\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u307e\u3059\u3002 iptables\u3092\u4f7f\u3046\u9ad8\u901f\u306a iptables \u30e2\u30fc\u30c9\u3068\u3001\u30e6\u30fc\u30b6\u30b9\u30da\u30fc\u30b9\u3067\u51e6\u7406\u3059\u308b userspace \u306e2\u3064\u306e\u30e2\u30fc\u30c9\u304c\u3042\u308a\u3001\u8d77\u52d5\u6642\u306e --proxy-mode \u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u6307\u5b9a\u3067\u304d\u307e\u3059\u3002\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u3001\u4f7f\u7528\u53ef\u80fd\u3067\u3042\u308c\u3070 iptables \u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u9078\u3070\u308c\u307e\u3059\u3002\u30ce\u30fc\u30c9\u306e\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3 net.experimental.kubernetes.io/proxy-mode \u3092\u4f7f\u3063\u3066\u30ce\u30fc\u30c9\u3054\u3068\u306b\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002 iptables \u30e2\u30fc\u30c9\u3092\u4f7f\u3063\u305f\u5834\u5408\u3001\u30e9\u30a6\u30f3\u30c9\u30ed\u30d3\u30f3\u306f stastic\u30e2\u30b8\u30e5\u30fc\u30eb \u306b\u3088\u3063\u3066\u884c\u308f\u308c\u307e\u3059\u3002 \u53c2\u8003 http://kubernetes.io/docs/admin/kube-proxy/ \u305d\u306e\u4ed6\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8 # hyperkube (all-in-one\u30d0\u30a4\u30ca\u30ea) # hyperkube\u306fKubernetes\u95a2\u9023\u306e\u30d0\u30a4\u30ca\u30ea\u30921\u3064\u306b\u307e\u3068\u3081\u305f\u3001all-in-one\u30d0\u30a4\u30ca\u30ea\u3067\u3059\u3002\u7b2c\u4e00\u5f15\u6570\u306b\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u540d\u524d\u3092\u6307\u5b9a\u3057\u3066\u4f7f\u3044\u307e\u3059\u3002\u307e\u305f\u3001busybox\u306e\u69d8\u306bsymlink\u3092\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u540d\u306b\u3057\u3066\u4f7f\u3046\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002 Kubernetes\u306e\u30ea\u30ea\u30fc\u30b9\u6bce\u306bDocker\u30a4\u30e1\u30fc\u30b8( gcr.io/google_containers/hyperkube-amd64 )\u3082\u66f4\u65b0\u3055\u308c\u3066\u304a\u308a\u3001Kubernetes\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092kubelet\u4e0a\u3067\u52d5\u304b\u3059\u5834\u5408\u306f\u3001hyperkube\u306eDocker\u30a4\u30e1\u30fc\u30b8\u3092\u4f7f\u7528\u3059\u308b\u306e\u304c\u4e00\u822c\u7684\u3067\u3059(e.g. Master\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30ebmaster.json )\u3002 \u5bfe\u5fdc\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306f\u4ee5\u4e0b\u3067\u3059\u3002\u62ec\u5f27\u5185\u306f\u5143\u306e\u30d0\u30a4\u30ca\u30ea\u540d\u3067\u3059\u3002 kubectl ( kubectl ) apiserver ( kube-apisever ) controller-manager ( kube-controller-manager ) scheduler ( kube-scheduler ) kubelet ( kubelet ) proxy ( kube-proxy ) $ hyperkube kubectl get nodes \u53c2\u8003: https://github.com/kubernetes/kubernetes/blob/master/cmd/hyperkube/main.go Pause\u30b3\u30f3\u30c6\u30ca # Pause\u30b3\u30f3\u30c6\u30ca\u306fPod\u5185\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30cd\u30fc\u30e0\u30b9\u30da\u30fc\u30b9\u306e\u60c5\u5831\u3092\u4fdd\u6301\u3059\u308b\u7279\u5225\u306a\u30b3\u30f3\u30c6\u30ca\u3067\u3001\u3059\u3079\u3066\u306ePod\u306b\u81ea\u52d5\u7684\u306b\u4ed8\u52a0\u3055\u308c\u307e\u3059\u3002Kubernetes\u5185\u90e8\u3067\u306f PodInfraContainerImage \u3068\u3044\u3046\u5b9a\u6570\u3067\u7279\u5225\u6271\u3044\u3055\u308c\u3066\u304a\u308a\u3001Pause\u30b3\u30f3\u30c6\u30ca\u3060\u3051\u304cPod\u5185\u3067\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30cd\u30fc\u30e0\u30b9\u30da\u30fc\u30b9\u306e\u60c5\u5831\u3092\u4fdd\u6301\u3057\u3001\u4ed6\u306e\u30b3\u30f3\u30c6\u30ca\u306f\u305d\u308c\u3092\u5171\u6709\u3059\u308b\u65b9\u5f0f\u3092\u53d6\u3063\u3066\u3044\u307e\u3059\u3002(\u53c2\u8003: pkg/kubelet/dockertools/manager.go )\u3002\u3053\u308c\u306b\u3088\u308aPod\u306e\u4ed6\u306e\u30b3\u30f3\u30c6\u30ca\u304ckill\u3055\u308c\u305f\u3068\u3057\u3066\u3082\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30cd\u30fc\u30e0\u30b9\u30da\u30fc\u30b9\u306e\u60c5\u5831\u3092\u4fdd\u6301\u3057\u3066\u304a\u304f\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002Pause\u30b3\u30f3\u30c6\u30ca\u81ea\u4f53\u306f\u6587\u5b57\u901a\u308apause\u30b7\u30b9\u30c6\u30e0\u30b3\u30fc\u30eb\u3092\u547c\u3073\u51fa\u3059\u3060\u3051\u3067\u4f55\u3082\u3057\u307e\u305b\u3093\u3002(\u53c2\u8003: pause.asm#L47 )\u3002Pause\u30b3\u30f3\u30c6\u30ca\u306fkubelet\u306e --pod-infra-container-image \u3068\u3044\u3046\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u30a4\u30e1\u30fc\u30b8\u3092\u5909\u66f4\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002 \u53c2\u8003 https://github.com/kubernetes/kubernetes/tree/master/third_party/pause Containers at Google > What is the role of 'pause' container? Add-on\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8 # pod-master # pod-master\u306fHigh-Availability\u69cb\u6210\u6642\u306b kube-scheduler , kube-controller-manager \u304c\u3069\u306eMaster\u3067\u52d5\u304f\u304b\u3092\u8abf\u6574\u3059\u308b\u30b3\u30f3\u30c6\u30ca\u3067\u3059\u3002etcd\u3092\u4f7f\u3063\u3066\u30ed\u30c3\u30af\u3092\u3059\u308b\u30b7\u30f3\u30d7\u30eb\u306a\u4ed5\u7d44\u307f\u3067\u3001200\u884c\u7a0b\u5ea6\u306ego\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u3067\u3059(\u53c2\u8003 podmaster.go )\u3002\u30ed\u30c3\u30af\u3092\u53d6\u5f97\u3057\u305fMaster\u30b5\u30fc\u30d0\u30fc\u304c\u30ed\u30fc\u30ab\u30eb\u306e\u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u53cd\u6620\u3055\u305b\u308b\u3068\u3044\u3046\u3084\u308a\u65b9\u3067\u3001\u3069\u306eMaster\u3067 kube-scheduler \u3001 kube-controller-manager \u3092\u52d5\u304b\u3059\u304b\u8abf\u6574\u3057\u3066\u3044\u307e\u3059\u3002kubernetes\u30ec\u30dd\u30b8\u30c8\u30ea\u306e docs/admin/high-availability \u306e podmaster.yaml \u306e\u8a2d\u5b9a\u4f8b\u304c\u53c2\u8003\u306b\u306a\u308a\u307e\u3059\u3002 kube-scheduler , kube-controller-manager \u81ea\u4f53\u306b\u3082\u30ea\u30fc\u30c0\u30fc\u9078\u51fa\u306e\u6a5f\u80fd( --leader-elect \u30aa\u30d7\u30b7\u30e7\u30f3)\u304c\u5b9f\u88c5\u3055\u308c\u3066\u3044\u308b\u3088\u3046\u306a\u306e\u3067\u3001\u4eca\u5f8c\u306f\u4e0d\u8981\u306b\u306a\u308b\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002(\u53c2\u8003 pkg/client/leaderelection ) \u53c2\u8003 https://github.com/kubernetes/contrib/tree/master/pod-master http://kubernetes.io/docs/admin/high-availability/ Issue: leaderelection: retrofit controller-manager with leaderelection client #19621 Issue: retrofit the scheduler with the leader election client. #19347 kube-dns # kube-dns \u306f\u30af\u30e9\u30b9\u30bf\u5185DNS\u306ePod\u306e\u540d\u524d\u3067\u3059\u3002Service\u30ea\u30bd\u30fc\u30b9\u304c\u4f5c\u3089\u308c\u305f\u6642\u3001kube-dns\u306b\u767b\u9332\u3055\u308c\u3001\u30af\u30e9\u30b9\u30bf\u5185\u90e8\u304b\u3089\u540d\u524d\u89e3\u6c7a\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f cluster.local \u3068\u3044\u3046\u30c9\u30e1\u30a4\u30f3\u304c\u4f7f\u308f\u308c\u307e\u3059\u3002Service\u306f {Service\u540d}.{\u30cd\u30fc\u30e0\u30b9\u30da\u30fc\u30b9}.svc.cluster.local \u3068\u3044\u3046\u5f62\u5f0f\u306eFQDN\u3067A\u30ec\u30b3\u30fc\u30c9\u3001SRV\u30ec\u30b3\u30fc\u30c9\u306b\u767b\u9332\u3055\u308c\u307e\u3059\u3002 kube-dns\u306ePod\u306f\u4ee5\u4e0b\u306e4\u30b3\u30f3\u30c6\u30ca\u3067\u69cb\u6210\u3055\u308c\u3066\u3044\u307e\u3059\u3002 skydns DNS\u30b5\u30fc\u30d0\u30fc etcd skydns\u306e\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3059\u308b\u5c02\u7528etcd kube2sky SkyDNS\u306bKubernetes\u306e\u60c5\u5831\u3092\u53cd\u6620\u3055\u305b\u308b\u30d6\u30ea\u30c3\u30b8 healthz \u5b9a\u671f\u7684\u306bnslookup\u3057\u3066\u30d8\u30eb\u30b9\u30c1\u30a7\u30c3\u30af\u3092\u884c\u3046 \u53c2\u8003 https://github.com/kubernetes/kubernetes/tree/master/cluster/addons/dns http://kubernetes.io/docs/admin/dns/ SkyDNS # \u30af\u30e9\u30b9\u30bf\u5185\u306eDNS\u3068\u3057\u3066\u4f7f\u308f\u308c\u3066\u3044\u308bDNS\u30b5\u30fc\u30d0\u30fc\u3067\u3059(kube-dns\u306e\u4e00\u90e8)\u3002\u30c7\u30fc\u30bf\u306e\u6c38\u7d9a\u5316\u306b\u306fetcd\u304c\u7528\u3044\u3089\u308c\u307e\u3059\u3002 \u53c2\u8003 https://github.com/skynetservices/skydns kube2sky # SkyDNS\u306bKubernetes\u306e\u60c5\u5831\u3092\u53cd\u6620\u3055\u305b\u308b\u30d6\u30ea\u30c3\u30b8\u3067\u3059\u3002Kubernetes\u306eAPI\u3067Service, Endpoints, Pod\u3092watch\u3057\u3001SkyDNS\u306eetcd\u306b\u66f8\u304d\u8fbc\u3080\u3053\u3068\u3067DNS\u306e\u60c5\u5831\u3092\u53cd\u6620\u3055\u305b\u307e\u3059\u3002 \u53c2\u8003 https://github.com/kubernetes/kubernetes/tree/master/cluster/addons/dns/kube2sky heapster # heapster\u306f\u30af\u30e9\u30b9\u30bf\u5168\u4f53\u306e\u4f7f\u7528\u72b6\u6cc1\u3092\u96c6\u7d04\u3059\u308b\u305f\u3081\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3067\u3059\u3002\u30b9\u30c8\u30ec\u30fc\u30b8\u306f\u30d7\u30e9\u30ac\u30d6\u30eb\u306a\u4ed5\u7d44\u307f\u306b\u306a\u3063\u3066\u304a\u308a\u3001InfluxDB, Google Cloud Monitoring, Kafka\u306a\u3069\u8907\u6570\u306e\u30b9\u30c8\u30ec\u30fc\u30b8\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u307e\u3059\u3002 https://github.com/kubernetes/heapster http://blog.kubernetes.io/2015/05/resource-usage-monitoring-kubernetes.html Helm (Deployment Manager) # Helm\u306fKubernetes\u306e\u8a2d\u5b9a\u3092\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u5316\u3057\u30c7\u30d7\u30ed\u30a4\u3092\u7ba1\u7406\u3057\u3084\u3059\u304f\u3059\u308b\u4ed5\u7d44\u307f\u3067\u3059\u3002\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306fCharts\u3068\u547c\u3070\u308c\u3001\u516c\u5f0f\u3067\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u30ec\u30dd\u30b8\u30c8\u30ea kubernetes/charts \u304c\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u73fe\u5728\u306f\u958b\u767a\u6bb5\u968e\u306e\u3088\u3046\u3067\u3059\u3002\u30a4\u30e1\u30fc\u30b8\u3068\u3057\u3066\u306fhomebrew\u306e\u3088\u3046\u306b\u3001kubernetes\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u66f8\u304f\u3053\u3068\u306a\u304f\u30c7\u30d7\u30ed\u30a4\u3092\u884c\u3048\u308b\u3082\u306e\u306e\u3088\u3046\u3067\u3059\u3002 $ helm install redis-cluster # replication controller\u3084service\u304c\u4f5c\u3089\u308c\u308b Jinja \u3068\u3044\u3046\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u304c\u4f7f\u308f\u308c\u3066\u3044\u3066\u3001Kubernetes\u306e\u5404\u7a2e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u5c55\u958b\u3057\u3066\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3067\u304d\u308b\u4ed5\u7d44\u307f\u306e\u3088\u3046\u3067\u3059\u3002(e.g. redis.jinja ) \u3082\u3068\u3082\u3068\u306fDeis\u306eHelm\u3068\u3044\u3046\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3068\u3001Kubernetes\u30c1\u30fc\u30e0\u304c\u958b\u767a\u3059\u308bdeployment-manager(dm)\u3068\u3044\u30462\u3064\u306e\u30c4\u30fc\u30eb\u304c\u3042\u3063\u305f\u3088\u3046\u3067\u3059\u3002 Integrate helm and dm #171 \u3068\u3044\u3046Issue\u306b\u3088\u308b\u3068\u3001\u30cf\u30c3\u30ab\u30bd\u30f3\u3067\u3053\u306e2\u3064\u3092\u7d71\u5408\u3059\u308b\u3068\u6c7a\u3081\u305f\u3089\u3057\u304f\u3001\u30ec\u30dd\u30b8\u30c8\u30ea\u540d\u3082\"deployment-manager\"\u304b\u3089\"helm\"\u306b\u5909\u66f4\u3057\u305f\u3088\u3046\u3067\u3059\u3002 http://kubernetes.io/docs/admin/cluster-components/ https://github.com/kubernetes/kubernetes/blob/master/docs/design/architecture.md","title":"Conponents"},{"location":"concepts/kubernetes/components/#kubernetes","text":"Source Kubernetes\u306e\u69cb\u6210\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306b\u3064\u3044\u3066\u4e00\u89a7\u3092\u307e\u3068\u3081\u3066\u307f\u307e\u3057\u305f\u3002Kubernetes 1.2\u6642\u70b9\u3067\u306e\u60c5\u5831\u3067\u3059\u3002 : \u5916\u90e8\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8 \u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8 \u7a2e\u5225 \u8aac\u660e etcd master Kubernetes\u306e\u30ea\u30bd\u30fc\u30b9\u306e\u6c38\u7d9a\u5316\u306b\u4f7f\u308f\u308c\u308b\u9ad8\u4fe1\u983c\u5206\u6563KVS kube-apiserver master Kubernetes\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u7ba1\u7406\u3059\u308bAPI\u30b5\u30fc\u30d0\u30fc kube-scheduler master Pod\u306e\u30ce\u30fc\u30c9\u3078\u306e\u5272\u308a\u5f53\u3066\u3092\u884c\u3046\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u30fc kube-controller-manager master Replication Controller\u306a\u3069\u306e\u5404\u7a2e\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u3092\u8d77\u52d5\u3057\u7ba1\u7406\u3059\u308b\u30de\u30cd\u30fc\u30b8\u30e3\u30fc kubelet node Pod\u3092\u8d77\u52d5\u3057\u7ba1\u7406\u3059\u308b\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8(Node\u306e\u30e1\u30a4\u30f3\u51e6\u7406) kube-proxy node Kubernetes\u306eService\u304c\u6301\u3064\u4eee\u60f3\u7684\u306aIP\u30a2\u30c9\u30ec\u30b9(cluster IP)\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3059\u308b kubectl client Kubernetes\u306eCLI\u30af\u30e9\u30a4\u30a2\u30f3\u30c8 hyperkube misc Kubernetes\u95a2\u9023\u306e\u30d0\u30a4\u30ca\u30ea\u30921\u3064\u306b\u307e\u3068\u3081\u305fall-in-one\u30d0\u30a4\u30ca\u30ea pause misc pod\u5185\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30afnamespace\u3092\u4fdd\u6301\u3059\u308b\u30b3\u30f3\u30c6\u30ca pod-master add-on High-Availability\u69cb\u6210\u6642\u306bscheduler, controller\u304c\u3069\u306eMaster\u3067\u52d5\u304f\u304b\u3092\u8abf\u6574\u3059\u308b\u30b3\u30f3\u30c6\u30ca kube-dns add-on \u30af\u30e9\u30b9\u30bf\u5185DNS\u306ePod SkyDNS add-on \u30af\u30e9\u30b9\u30bf\u5185DNS\u306eDNS\u30b5\u30fc\u30d0\u30fc kube2sky add-on SkyDNS\u306bKubernetes\u306e\u60c5\u5831\u3092\u53cd\u6620\u3055\u305b\u308b\u30d6\u30ea\u30c3\u30b8 heapster add-on Kuernetes\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u60c5\u5831\u3092\u96c6\u7d04\u3059\u308b\u4ed5\u7d44\u307f helm(Deployment Manager) add-on Kubernetes\u306e\u8a2d\u5b9a\u3092\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u5316\u3057\u30c7\u30d7\u30ed\u30a4\u3092\u7ba1\u7406\u3057\u3084\u3059\u304f\u3059\u308b\u4ed5\u7d44\u307f","title":"Kubernetes\u306e\u69cb\u6210\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8"},{"location":"concepts/kubernetes/components/#_1","text":"","title":"\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3"},{"location":"concepts/kubernetes/components/#master","text":"","title":"Master\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8"},{"location":"concepts/kubernetes/components/#etcd","text":"etcd\u306fKubernetes\u306e\u30ea\u30bd\u30fc\u30b9\u306e\u6c38\u7d9a\u5316\u306b\u4f7f\u308f\u308c\u308b\u9ad8\u4fe1\u983c\u5206\u6563KVS\u3067\u3059\u3002etcd\u306fKubernetes\u306e\u30ea\u30bd\u30fc\u30b9\u4ee5\u5916\u306b\u3082\u3001\u5f8c\u8ff0\u306eSkyDNS\u3001pod-master\u306a\u3069\u306e\u4fdd\u5b58\u306e\u7528\u9014\u306b\u3082\u4f7f\u308f\u308c\u3066\u3044\u307e\u3059(etcd\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306f\u4e00\u822c\u7684\u306b\u5225\u306b\u306a\u308a\u307e\u3059)\u3002 etcd\u306e\u30ad\u30fc\u306f\u30d1\u30b9\u5f62\u5f0f\u306b\u306a\u3063\u3066\u304a\u308a\u3001API Server\u306e --etcd-prefix \u30aa\u30d7\u30b7\u30e7\u30f3(\u30c7\u30d5\u30a9\u30eb\u30c8\u306f /registry )\u3067\u6307\u5b9a\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4ee5\u4e0b\u306b\u4fdd\u5b58\u3055\u308c\u307e\u3059\u3002\u3002\u307e\u305f --etcd-servers-overrides \u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u30ea\u30bd\u30fc\u30b9\u306e\u7a2e\u985e\u3054\u3068\u306betcd\u306e\u30b5\u30fc\u30d0\u30fc\u3092\u5909\u3048\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\u5927\u898f\u6a21\u74b0\u5883\u306b\u304a\u3044\u3066\u306fEvents\u30ea\u30bd\u30fc\u30b9\u306f\u91cf\u304c\u591a\u3044\u305f\u3081\u3001etcd\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u5225\u306b\u3059\u308b\u3053\u3068\u304c\u63a8\u5968\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u8a73\u7d30\u306fKubernetes\u30de\u30cb\u30e5\u30a2\u30eb\u306e kube-apiserver \u3068 Using Large Clusters \u306e\u9805\u3092\u53c2\u7167\u304f\u3060\u3055\u3044\u3002 etcd\u306fLinux\u30b3\u30f3\u30c6\u30ca\u5411\u3051distro\u306eCoreOS\u3092\u958b\u767a\u3059\u308b\u3001 CoreOS\u793e \u304c\u958b\u767a\u3057\u3066\u3044\u307e\u3059\u3002 \u53c2\u8003 https://github.com/coreos/etcd Kubernetes\u306eSecret\u306f\u672c\u5f53\u306b\u5b89\u5168\u304b - Qiita Kubernetes Secrets \u306e\u7d39\u4ecb \u2013 \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3084\u305d\u306e\u4ed6\u79d8\u5bc6\u60c5\u5831\u3092\u3069\u3053\u306b\u4fdd\u5b58\u3059\u308b\u304b\uff1f \u2013 \u3086\u3073\u3066\u304f","title":"etcd"},{"location":"concepts/kubernetes/components/#etcd_1","text":"Kubernetes\u30ea\u30bd\u30fc\u30b9\u306eetcd\u306e\u30ad\u30fc\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u4fdd\u5b58\u3055\u308c\u3066\u3044\u307e\u3059\u3002 # etcd\u306e \"/registry\" \u4ee5\u4e0b\u306e\u30ad\u30fc\u540d\u3092\u8868\u793a $ etcdctl ls --recursive /registry # \u30b5\u30f3\u30d7\u30eb\u3092\u629c\u7c8b /registry/namespaces/default /registry/namespaces/kube-system /registry/secrets/default/default-token-qfomx /registry/secrets/kube-system/default-token-bf0m1 /registry/minions/172.17.4.101 /registry/minions/172.17.4.201 /registry/pods/kube-system/kube-controller-manager-172.17.4.101 /registry/pods/kube-system/heapster-v10-ut5ls value\u306b\u306f\u30ea\u30bd\u30fc\u30b9\u306eJSON\u6587\u5b57\u5217\u304c\u305d\u306e\u307e\u307e\u5165\u3063\u3066\u3044\u307e\u3059\u3002 $ etcdctl get /registry/ranges/serviceips | jq . { \"kind\": \"RangeAllocation\", \"apiVersion\": \"v1\", \"metadata\": { \"creationTimestamp\": null }, \"range\": \"10.3.0.0/24\", \"data\": \"IAAACAAAAAAIAAAAAAAAAAAAAAAAAAABAAAAAAADAQ==\" }","title":"\u53c2\u8003: etcd\u306b\u4fdd\u5b58\u3055\u308c\u3066\u3044\u308b\u30c7\u30fc\u30bf\u306e\u30b5\u30f3\u30d7\u30eb"},{"location":"concepts/kubernetes/components/#kube-apiserver","text":"Kubernetes\u306eAPI\u30b5\u30fc\u30d0\u30fc\u3067\u3001\u4e3b\u306bKubernetes\u306e\u30ea\u30bd\u30fc\u30b9\u60c5\u5831\u306e\u7ba1\u7406\u3092\u62c5\u3063\u3066\u3044\u307e\u3059\u3002\u57fa\u672c\u7684\u306b\u30ea\u30bd\u30fc\u30b9\u60c5\u5831\u306eCRUD\u51e6\u7406\u306e\u307f\u3092\u884c\u3044\u3001\u30ea\u30bd\u30fc\u30b9\u306b\u5bfe\u3059\u308b\u5b9f\u969b\u306e\u51e6\u7406\u3084\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u306f\u5225\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8( kube-controller-manager \u3068 kube-scheduler )\u304c\u884c\u3044\u307e\u3059\u3002\u30ea\u30bd\u30fc\u30b9\u306e\u72b6\u614b\u306f\u3059\u3079\u3066etcd\u306b\u4fdd\u5b58\u3055\u308c\u307e\u3059\u3002API\u30b5\u30fc\u30d0\u30fc\u4ee5\u5916\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306f\u76f4\u63a5etcd\u3092\u53c2\u7167\u305b\u305a\u3001API\u30b5\u30fc\u30d0\u30fc\u3092\u901a\u3057\u3066\u30ea\u30bd\u30fc\u30b9\u306b\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002 kubectl \u30b3\u30de\u30f3\u30c9\u3082\u3001API\u30b5\u30fc\u30d0\u30fc\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u901a\u3057\u3066\u64cd\u4f5c\u3092\u884c\u3063\u3066\u3044\u307e\u3059\u3002 \u8a8d\u8a3c\u3001\u8a8d\u53ef\u306e\u4ed6\u306b\u3001Admission Control (\u53c2\u8003: Kubernetes: Admission Control\u3068\u306f\u4f55\u304b ) \u3068\u3044\u3046\u30ea\u30af\u30a8\u30b9\u30c8\u5236\u5fa1\u306e\u4ed5\u7d44\u307f\u3092\u5099\u3048\u3066\u3044\u307e\u3059\u3002 \u6c34\u5e73\u30b9\u30b1\u30fc\u30eb\u3055\u305b\u308b\u3053\u3068\u304c\u53ef\u80fd\u306a\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3067\u3059\u3002 \u53c2\u8003 http://kubernetes.io/docs/admin/kube-apiserver/","title":"kube-apiserver"},{"location":"concepts/kubernetes/components/#kube-scheduler","text":"\u65b0\u3057\u304f\u4f5c\u3089\u308c\u305fPod\u306e\u30ce\u30fc\u30c9\u3078\u306e\u5272\u308a\u5f53\u3066\u3092\u884c\u3046\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u30fc\u3067\u3059\u3002Kubernetes API\u3092\u901a\u3057\u3066\u3001Pod, Node\u306a\u3069\u306e\u30ea\u30bd\u30fc\u30b9\u3092watch\u3057\u3001 bindings API \u3067Node\u3068Pod\u306e\u3072\u3082\u4ed8\u3051\u3092\u884c\u3044\u307e\u3059\u3002\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u306e\u30dd\u30ea\u30b7\u30fc\u306f\u8a2d\u5b9a\u53ef\u80fd\u3067\u3001 --policy-config-file \u3068\u3044\u3046\u8d77\u52d5\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u8a2d\u5b9a\u306ejson\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002(\u53c2\u8003: scheduler-policy-config.json ) \u53c2\u8003 https://github.com/kubernetes/kubernetes/blob/master/docs/devel/scheduler.md","title":"kube-scheduler"},{"location":"concepts/kubernetes/components/#kube-controller-manager","text":"Replication Controller\u306a\u3069\u306e\u5404\u7a2e\u30ea\u30bd\u30fc\u30b9\u306e\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u3092\u8d77\u52d5\u3059\u308b\u30de\u30cd\u30fc\u30b8\u30e3\u30fc\u3067\u3059\u3002\u5404\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u306fgoroutine\u3067\u8d77\u52d5\u3055\u308c\u307e\u3059\u3002(\u53c2\u8003: controllermanager.go#L185-L390 )\u3002\u306a\u304a\u3001Replication Controller\u306f\u30ea\u30bd\u30fc\u30b9\u540d\u81ea\u4f53\u306b\"Controller\"\u3068\u3064\u304f\u305f\u3081\u3001\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u306f\"RepplicationManager\"\u3068\u3044\u3046\u540d\u524d\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002(\u53c2\u8003: replication_controller.go#L63-L64\u306e\u30b3\u30e1\u30f3\u30c8 ) \u4e0b\u8a18\u306f kube-controller-manager \u3092pprof\u3067\u898b\u305f\u3001goroutine\u3067\u8d77\u52d5\u3059\u308b\u5404\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u306b\u95a2\u3059\u308b\u51e6\u7406\u306e\u4e00\u89a7\u3067\u3059\u3002 k8s.io/kubernetes/pkg/controller/daemon.(*DaemonSetsController).Run k8s.io/kubernetes/pkg/controller/deployment.(*DeploymentController).Run k8s.io/kubernetes/pkg/controller/endpoint.(*EndpointController).Run k8s.io/kubernetes/pkg/controller/gc.(*GCController).Run k8s.io/kubernetes/pkg/controller/job.(*JobController).Run k8s.io/kubernetes/pkg/controller/namespace.(*NamespaceController).Run k8s.io/kubernetes/pkg/controller/node.(*NodeController).Run k8s.io/kubernetes/pkg/controller/persistentvolume.(*PersistentVolumeClaimBinder).Run k8s.io/kubernetes/pkg/controller/persistentvolume.(*PersistentVolumeRecycler).Run k8s.io/kubernetes/pkg/controller/podautoscaler.(*HorizontalController).Run k8s.io/kubernetes/pkg/controller/replicaset.(*ReplicaSetController).Run k8s.io/kubernetes/pkg/controller/replication.(*ReplicationManager).Run k8s.io/kubernetes/pkg/controller/resourcequota.(*ResourceQuotaController).Run k8s.io/kubernetes/pkg/controller/serviceaccount.(*ServiceAccountsController).Run k8s.io/kubernetes/pkg/controller/serviceaccount.(*TokensController).Run \u53c2\u8003 http://kubernetes.io/docs/admin/kube-controller-manager/","title":"kube-controller-manager"},{"location":"concepts/kubernetes/components/#node","text":"","title":"Node\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8"},{"location":"concepts/kubernetes/components/#kubelet","text":"kubelet\u306f\u5404\u30ce\u30fc\u30c9\u3067\u52d5\u4f5c\u3059\u308b\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3067\u3001Node\u306e\u30e1\u30a4\u30f3\u51e6\u7406\u3067\u3042\u308bPod\u306e\u8d77\u52d5\u30fb\u7ba1\u7406\u3092\u884c\u3044\u307e\u3059\u3002\u8d77\u52d5\u3059\u308bPod\u306e\u60c5\u5831\u306f\u3001API\u30b5\u30fc\u30d0\u30fc\u3092\u76e3\u8996\u3057\u3066\u81ea\u30ce\u30fc\u30c9\u306b\u5272\u308a\u5f53\u3066\u3089\u308c\u305f\u3082\u306e\u3092\u898b\u308b\u306e\u304c\u4e3b\u3067\u3059\u304c\u3001\u4ed6\u306b\u3082\u4e0b\u8a18\u306e3\u3064\u306e\u65b9\u6cd5\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u4ed5\u7d44\u307f\u3092\u4f7f\u3046\u3053\u3068\u3067API\u30b5\u30fc\u30d0\u30fc\u3092\u542b\u3080Master\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3082\u3001kubelet\u4e0a\u3067\u52d5\u4f5c\u3055\u305b\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002 \u30ed\u30fc\u30ab\u30eb\u30d5\u30a1\u30a4\u30eb \u30ce\u30fc\u30c9\u306e\u7279\u5b9a\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea(\u4f8b\u3048\u3070 /etc/kubernetes/manifests )\u3092\u76e3\u8996\u3057\u3001\u305d\u3053\u306b\u7f6e\u304b\u308c\u305f\u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u306b\u66f8\u304b\u308c\u305fPod\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\u76e3\u8996\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u307e\u305f\u306f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306f --config \u30aa\u30d7\u30b7\u30e7\u30f3\u3001\u76e3\u8996\u9593\u9694\u306f --file-check-frequency \u30aa\u30d7\u30b7\u30e7\u30f3(\u30c7\u30d5\u30a9\u30eb\u30c8\u306f20\u79d2)\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002 HTTP\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8 \u7279\u5b9a\u306eURL\u3092\u76e3\u8996\u3057\u3001\u305d\u3053\u306b\u7f6e\u304b\u308c\u305f\u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u306b\u66f8\u304b\u308c\u305fPod\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\u76e3\u8996\u3059\u308bURL\u306f --manifest-url \u30aa\u30d7\u30b7\u30e7\u30f3\u3001\u76e3\u8996\u9593\u9694\u306f --http-check-frequency= \u30aa\u30d7\u30b7\u30e7\u30f3(\u30c7\u30d5\u30a9\u30eb\u30c8\u306f20\u79d2)\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002 HTTP\u30b5\u30fc\u30d0\u30fc Kubelet\u81ea\u4f53\u6301\u3064\u306eHTTP\u30b5\u30fc\u30d0\u30fc\u306b\u5bfe\u3057\u3066\u3001\u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u3092\u9001\u4fe1\u3059\u308b\u65b9\u6cd5\u3067\u3059\u3002 \u53c2\u8003 http://kubernetes.io/docs/admin/kubelet/","title":"kubelet"},{"location":"concepts/kubernetes/components/#kube-proxy","text":"kube-proxy\u306f\u5404\u30ce\u30fc\u30c9\u3067\u52d5\u4f5c\u3059\u308b\u3001Service\u304c\u6301\u3064\u4eee\u60f3\u7684\u306aCluster IP\u3092\u8ee2\u9001\u3059\u308b\u305f\u3081\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30afProxy\u3067\u3059\u3002\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b9\u306f\u73fe\u72b6\u3067\u306f\u30e9\u30a6\u30f3\u30c9\u30ed\u30d3\u30f3\u306e\u307f\u304c\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u307e\u3059\u3002 iptables\u3092\u4f7f\u3046\u9ad8\u901f\u306a iptables \u30e2\u30fc\u30c9\u3068\u3001\u30e6\u30fc\u30b6\u30b9\u30da\u30fc\u30b9\u3067\u51e6\u7406\u3059\u308b userspace \u306e2\u3064\u306e\u30e2\u30fc\u30c9\u304c\u3042\u308a\u3001\u8d77\u52d5\u6642\u306e --proxy-mode \u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u6307\u5b9a\u3067\u304d\u307e\u3059\u3002\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u3001\u4f7f\u7528\u53ef\u80fd\u3067\u3042\u308c\u3070 iptables \u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u9078\u3070\u308c\u307e\u3059\u3002\u30ce\u30fc\u30c9\u306e\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3 net.experimental.kubernetes.io/proxy-mode \u3092\u4f7f\u3063\u3066\u30ce\u30fc\u30c9\u3054\u3068\u306b\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002 iptables \u30e2\u30fc\u30c9\u3092\u4f7f\u3063\u305f\u5834\u5408\u3001\u30e9\u30a6\u30f3\u30c9\u30ed\u30d3\u30f3\u306f stastic\u30e2\u30b8\u30e5\u30fc\u30eb \u306b\u3088\u3063\u3066\u884c\u308f\u308c\u307e\u3059\u3002 \u53c2\u8003 http://kubernetes.io/docs/admin/kube-proxy/","title":"kube-proxy"},{"location":"concepts/kubernetes/components/#_2","text":"","title":"\u305d\u306e\u4ed6\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8"},{"location":"concepts/kubernetes/components/#hyperkube-all-in-one","text":"hyperkube\u306fKubernetes\u95a2\u9023\u306e\u30d0\u30a4\u30ca\u30ea\u30921\u3064\u306b\u307e\u3068\u3081\u305f\u3001all-in-one\u30d0\u30a4\u30ca\u30ea\u3067\u3059\u3002\u7b2c\u4e00\u5f15\u6570\u306b\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u540d\u524d\u3092\u6307\u5b9a\u3057\u3066\u4f7f\u3044\u307e\u3059\u3002\u307e\u305f\u3001busybox\u306e\u69d8\u306bsymlink\u3092\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u540d\u306b\u3057\u3066\u4f7f\u3046\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002 Kubernetes\u306e\u30ea\u30ea\u30fc\u30b9\u6bce\u306bDocker\u30a4\u30e1\u30fc\u30b8( gcr.io/google_containers/hyperkube-amd64 )\u3082\u66f4\u65b0\u3055\u308c\u3066\u304a\u308a\u3001Kubernetes\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092kubelet\u4e0a\u3067\u52d5\u304b\u3059\u5834\u5408\u306f\u3001hyperkube\u306eDocker\u30a4\u30e1\u30fc\u30b8\u3092\u4f7f\u7528\u3059\u308b\u306e\u304c\u4e00\u822c\u7684\u3067\u3059(e.g. Master\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30ebmaster.json )\u3002 \u5bfe\u5fdc\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306f\u4ee5\u4e0b\u3067\u3059\u3002\u62ec\u5f27\u5185\u306f\u5143\u306e\u30d0\u30a4\u30ca\u30ea\u540d\u3067\u3059\u3002 kubectl ( kubectl ) apiserver ( kube-apisever ) controller-manager ( kube-controller-manager ) scheduler ( kube-scheduler ) kubelet ( kubelet ) proxy ( kube-proxy ) $ hyperkube kubectl get nodes \u53c2\u8003: https://github.com/kubernetes/kubernetes/blob/master/cmd/hyperkube/main.go","title":"hyperkube (all-in-one\u30d0\u30a4\u30ca\u30ea)"},{"location":"concepts/kubernetes/components/#pause","text":"Pause\u30b3\u30f3\u30c6\u30ca\u306fPod\u5185\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30cd\u30fc\u30e0\u30b9\u30da\u30fc\u30b9\u306e\u60c5\u5831\u3092\u4fdd\u6301\u3059\u308b\u7279\u5225\u306a\u30b3\u30f3\u30c6\u30ca\u3067\u3001\u3059\u3079\u3066\u306ePod\u306b\u81ea\u52d5\u7684\u306b\u4ed8\u52a0\u3055\u308c\u307e\u3059\u3002Kubernetes\u5185\u90e8\u3067\u306f PodInfraContainerImage \u3068\u3044\u3046\u5b9a\u6570\u3067\u7279\u5225\u6271\u3044\u3055\u308c\u3066\u304a\u308a\u3001Pause\u30b3\u30f3\u30c6\u30ca\u3060\u3051\u304cPod\u5185\u3067\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30cd\u30fc\u30e0\u30b9\u30da\u30fc\u30b9\u306e\u60c5\u5831\u3092\u4fdd\u6301\u3057\u3001\u4ed6\u306e\u30b3\u30f3\u30c6\u30ca\u306f\u305d\u308c\u3092\u5171\u6709\u3059\u308b\u65b9\u5f0f\u3092\u53d6\u3063\u3066\u3044\u307e\u3059\u3002(\u53c2\u8003: pkg/kubelet/dockertools/manager.go )\u3002\u3053\u308c\u306b\u3088\u308aPod\u306e\u4ed6\u306e\u30b3\u30f3\u30c6\u30ca\u304ckill\u3055\u308c\u305f\u3068\u3057\u3066\u3082\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30cd\u30fc\u30e0\u30b9\u30da\u30fc\u30b9\u306e\u60c5\u5831\u3092\u4fdd\u6301\u3057\u3066\u304a\u304f\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002Pause\u30b3\u30f3\u30c6\u30ca\u81ea\u4f53\u306f\u6587\u5b57\u901a\u308apause\u30b7\u30b9\u30c6\u30e0\u30b3\u30fc\u30eb\u3092\u547c\u3073\u51fa\u3059\u3060\u3051\u3067\u4f55\u3082\u3057\u307e\u305b\u3093\u3002(\u53c2\u8003: pause.asm#L47 )\u3002Pause\u30b3\u30f3\u30c6\u30ca\u306fkubelet\u306e --pod-infra-container-image \u3068\u3044\u3046\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u30a4\u30e1\u30fc\u30b8\u3092\u5909\u66f4\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002 \u53c2\u8003 https://github.com/kubernetes/kubernetes/tree/master/third_party/pause Containers at Google > What is the role of 'pause' container?","title":"Pause\u30b3\u30f3\u30c6\u30ca"},{"location":"concepts/kubernetes/components/#add-on","text":"","title":"Add-on\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8"},{"location":"concepts/kubernetes/components/#pod-master","text":"pod-master\u306fHigh-Availability\u69cb\u6210\u6642\u306b kube-scheduler , kube-controller-manager \u304c\u3069\u306eMaster\u3067\u52d5\u304f\u304b\u3092\u8abf\u6574\u3059\u308b\u30b3\u30f3\u30c6\u30ca\u3067\u3059\u3002etcd\u3092\u4f7f\u3063\u3066\u30ed\u30c3\u30af\u3092\u3059\u308b\u30b7\u30f3\u30d7\u30eb\u306a\u4ed5\u7d44\u307f\u3067\u3001200\u884c\u7a0b\u5ea6\u306ego\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u3067\u3059(\u53c2\u8003 podmaster.go )\u3002\u30ed\u30c3\u30af\u3092\u53d6\u5f97\u3057\u305fMaster\u30b5\u30fc\u30d0\u30fc\u304c\u30ed\u30fc\u30ab\u30eb\u306e\u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u53cd\u6620\u3055\u305b\u308b\u3068\u3044\u3046\u3084\u308a\u65b9\u3067\u3001\u3069\u306eMaster\u3067 kube-scheduler \u3001 kube-controller-manager \u3092\u52d5\u304b\u3059\u304b\u8abf\u6574\u3057\u3066\u3044\u307e\u3059\u3002kubernetes\u30ec\u30dd\u30b8\u30c8\u30ea\u306e docs/admin/high-availability \u306e podmaster.yaml \u306e\u8a2d\u5b9a\u4f8b\u304c\u53c2\u8003\u306b\u306a\u308a\u307e\u3059\u3002 kube-scheduler , kube-controller-manager \u81ea\u4f53\u306b\u3082\u30ea\u30fc\u30c0\u30fc\u9078\u51fa\u306e\u6a5f\u80fd( --leader-elect \u30aa\u30d7\u30b7\u30e7\u30f3)\u304c\u5b9f\u88c5\u3055\u308c\u3066\u3044\u308b\u3088\u3046\u306a\u306e\u3067\u3001\u4eca\u5f8c\u306f\u4e0d\u8981\u306b\u306a\u308b\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002(\u53c2\u8003 pkg/client/leaderelection ) \u53c2\u8003 https://github.com/kubernetes/contrib/tree/master/pod-master http://kubernetes.io/docs/admin/high-availability/ Issue: leaderelection: retrofit controller-manager with leaderelection client #19621 Issue: retrofit the scheduler with the leader election client. #19347","title":"pod-master"},{"location":"concepts/kubernetes/components/#kube-dns","text":"kube-dns \u306f\u30af\u30e9\u30b9\u30bf\u5185DNS\u306ePod\u306e\u540d\u524d\u3067\u3059\u3002Service\u30ea\u30bd\u30fc\u30b9\u304c\u4f5c\u3089\u308c\u305f\u6642\u3001kube-dns\u306b\u767b\u9332\u3055\u308c\u3001\u30af\u30e9\u30b9\u30bf\u5185\u90e8\u304b\u3089\u540d\u524d\u89e3\u6c7a\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f cluster.local \u3068\u3044\u3046\u30c9\u30e1\u30a4\u30f3\u304c\u4f7f\u308f\u308c\u307e\u3059\u3002Service\u306f {Service\u540d}.{\u30cd\u30fc\u30e0\u30b9\u30da\u30fc\u30b9}.svc.cluster.local \u3068\u3044\u3046\u5f62\u5f0f\u306eFQDN\u3067A\u30ec\u30b3\u30fc\u30c9\u3001SRV\u30ec\u30b3\u30fc\u30c9\u306b\u767b\u9332\u3055\u308c\u307e\u3059\u3002 kube-dns\u306ePod\u306f\u4ee5\u4e0b\u306e4\u30b3\u30f3\u30c6\u30ca\u3067\u69cb\u6210\u3055\u308c\u3066\u3044\u307e\u3059\u3002 skydns DNS\u30b5\u30fc\u30d0\u30fc etcd skydns\u306e\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3059\u308b\u5c02\u7528etcd kube2sky SkyDNS\u306bKubernetes\u306e\u60c5\u5831\u3092\u53cd\u6620\u3055\u305b\u308b\u30d6\u30ea\u30c3\u30b8 healthz \u5b9a\u671f\u7684\u306bnslookup\u3057\u3066\u30d8\u30eb\u30b9\u30c1\u30a7\u30c3\u30af\u3092\u884c\u3046 \u53c2\u8003 https://github.com/kubernetes/kubernetes/tree/master/cluster/addons/dns http://kubernetes.io/docs/admin/dns/","title":"kube-dns"},{"location":"concepts/kubernetes/components/#skydns","text":"\u30af\u30e9\u30b9\u30bf\u5185\u306eDNS\u3068\u3057\u3066\u4f7f\u308f\u308c\u3066\u3044\u308bDNS\u30b5\u30fc\u30d0\u30fc\u3067\u3059(kube-dns\u306e\u4e00\u90e8)\u3002\u30c7\u30fc\u30bf\u306e\u6c38\u7d9a\u5316\u306b\u306fetcd\u304c\u7528\u3044\u3089\u308c\u307e\u3059\u3002 \u53c2\u8003 https://github.com/skynetservices/skydns","title":"SkyDNS"},{"location":"concepts/kubernetes/components/#kube2sky","text":"SkyDNS\u306bKubernetes\u306e\u60c5\u5831\u3092\u53cd\u6620\u3055\u305b\u308b\u30d6\u30ea\u30c3\u30b8\u3067\u3059\u3002Kubernetes\u306eAPI\u3067Service, Endpoints, Pod\u3092watch\u3057\u3001SkyDNS\u306eetcd\u306b\u66f8\u304d\u8fbc\u3080\u3053\u3068\u3067DNS\u306e\u60c5\u5831\u3092\u53cd\u6620\u3055\u305b\u307e\u3059\u3002 \u53c2\u8003 https://github.com/kubernetes/kubernetes/tree/master/cluster/addons/dns/kube2sky","title":"kube2sky"},{"location":"concepts/kubernetes/components/#heapster","text":"heapster\u306f\u30af\u30e9\u30b9\u30bf\u5168\u4f53\u306e\u4f7f\u7528\u72b6\u6cc1\u3092\u96c6\u7d04\u3059\u308b\u305f\u3081\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3067\u3059\u3002\u30b9\u30c8\u30ec\u30fc\u30b8\u306f\u30d7\u30e9\u30ac\u30d6\u30eb\u306a\u4ed5\u7d44\u307f\u306b\u306a\u3063\u3066\u304a\u308a\u3001InfluxDB, Google Cloud Monitoring, Kafka\u306a\u3069\u8907\u6570\u306e\u30b9\u30c8\u30ec\u30fc\u30b8\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u307e\u3059\u3002 https://github.com/kubernetes/heapster http://blog.kubernetes.io/2015/05/resource-usage-monitoring-kubernetes.html","title":"heapster"},{"location":"concepts/kubernetes/components/#helm-deployment-manager","text":"Helm\u306fKubernetes\u306e\u8a2d\u5b9a\u3092\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u5316\u3057\u30c7\u30d7\u30ed\u30a4\u3092\u7ba1\u7406\u3057\u3084\u3059\u304f\u3059\u308b\u4ed5\u7d44\u307f\u3067\u3059\u3002\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306fCharts\u3068\u547c\u3070\u308c\u3001\u516c\u5f0f\u3067\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u30ec\u30dd\u30b8\u30c8\u30ea kubernetes/charts \u304c\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u73fe\u5728\u306f\u958b\u767a\u6bb5\u968e\u306e\u3088\u3046\u3067\u3059\u3002\u30a4\u30e1\u30fc\u30b8\u3068\u3057\u3066\u306fhomebrew\u306e\u3088\u3046\u306b\u3001kubernetes\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u66f8\u304f\u3053\u3068\u306a\u304f\u30c7\u30d7\u30ed\u30a4\u3092\u884c\u3048\u308b\u3082\u306e\u306e\u3088\u3046\u3067\u3059\u3002 $ helm install redis-cluster # replication controller\u3084service\u304c\u4f5c\u3089\u308c\u308b Jinja \u3068\u3044\u3046\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u304c\u4f7f\u308f\u308c\u3066\u3044\u3066\u3001Kubernetes\u306e\u5404\u7a2e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u5c55\u958b\u3057\u3066\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3067\u304d\u308b\u4ed5\u7d44\u307f\u306e\u3088\u3046\u3067\u3059\u3002(e.g. redis.jinja ) \u3082\u3068\u3082\u3068\u306fDeis\u306eHelm\u3068\u3044\u3046\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3068\u3001Kubernetes\u30c1\u30fc\u30e0\u304c\u958b\u767a\u3059\u308bdeployment-manager(dm)\u3068\u3044\u30462\u3064\u306e\u30c4\u30fc\u30eb\u304c\u3042\u3063\u305f\u3088\u3046\u3067\u3059\u3002 Integrate helm and dm #171 \u3068\u3044\u3046Issue\u306b\u3088\u308b\u3068\u3001\u30cf\u30c3\u30ab\u30bd\u30f3\u3067\u3053\u306e2\u3064\u3092\u7d71\u5408\u3059\u308b\u3068\u6c7a\u3081\u305f\u3089\u3057\u304f\u3001\u30ec\u30dd\u30b8\u30c8\u30ea\u540d\u3082\"deployment-manager\"\u304b\u3089\"helm\"\u306b\u5909\u66f4\u3057\u305f\u3088\u3046\u3067\u3059\u3002 http://kubernetes.io/docs/admin/cluster-components/ https://github.com/kubernetes/kubernetes/blob/master/docs/design/architecture.md","title":"Helm (Deployment Manager)"},{"location":"concepts/kubernetes/helm/","text":"Helm \u306e\u57fa\u672c\u7684\u306a\u4f7f\u3044\u65b9 # Kubernetes \u306e\u554f\u984c\u306e\uff11\u3064\u306b\u3001 \u30de\u30cb\u30d5\u30a7\u30b9\u30c8 \u30d5\u30a1\u30a4\u30eb\u304c\u305f\u304f\u3055\u3093\u3067\u304d\u308b YAML\u306e\u58c1 \u3068\u547c\u3070\u308c\u308b\u3082\u306e\u304c\u3042\u308a\u307e\u3059\u3002 image mount\u3059\u308b\u30d5\u30a1\u30a4\u30eb label \u30ea\u30bd\u30fc\u30b9\u5272\u5f53 \u3068\u3044\u3063\u305f\u4e00\u90e8\u306e\u8981\u7d20\u3060\u3051\u5909\u3048\u305f\u3044\u6642\u3001\u307b\u3068\u3093\u3069\u69cb\u6210\u306f\u540c\u3058\u3067\u4f3c\u305f\u3088\u3046\u306a \u30de\u30cb\u30d5\u30a7\u30b9\u30c8 \u30d5\u30a1\u30a4\u30eb\u304c\u5927\u91cf\u306b\u51fa\u3066\u3057\u307e\u3044\u307e\u3059\u3002 \u305d\u3057\u3066\u305d\u3046\u3044\u3063\u305f\u30d5\u30a1\u30a4\u30eb\u306f\u5f80\u3005\u306b\u3057\u3066\u7ba1\u7406\u3055\u308c\u305a\u8ca0\u50b5\u3068\u306a\u3063\u3066\u3044\u304d\u307e\u3059\u3002 \u305d\u308c\u3092\u89e3\u6c7a\u3059\u308b\u306e\u304cHelm\u3068\u3044\u3046 Kubernetes \u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u30de\u30cd\u30fc\u30b8\u30e3\u3067\u3059\u3002 \u5171\u901a\u90e8\u5206\u3092\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u5316\u3057\u3001\u53ef\u5909\u90e8\u5206\u3092\u5909\u6570\u3067\u6271\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002 \u4eca\u56de\u306f\u305d\u306eHelm\u306e\u57fa\u672c\u7684\u306a\u4f7f\u3044\u65b9\u3092\u8aac\u660e\u3057\u307e\u3059\u3002 Helm\u3092\u30b7\u30b9\u30c6\u30e0 \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3 \u306f\u4ee5\u4e0b\u3067\u3059\u3002 ref: Simplifying App Deployment in Kubernetes with Helm Charts \u56f3\u304b\u3089\u308f\u304b\u308b\u3088\u3046\u306bTiller\u3068\u547c\u3070\u308c\u308b\u30b5\u30fc\u30d0\u304c Kubernetes Cluster\u5185\u3067\u8d77\u52d5\u3057\u3001 api -server\u3092\u30b3\u30fc\u30eb\u3057\u3066\u30c7\u30d7\u30ed\u30a4\u3092\u884c\u3044\u307e\u3059\u3002 \u899a\u3048\u3066\u304a\u3044\u305f\u65b9\u304c\u3088\u3044\u5358\u8a9e\u306f\u4ee5\u4e0b\u3067\u3059\u3002 \u7528\u8a9e \u8aac\u660e Chart Helm\u3067\u5229\u7528\u3059\u308b\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8 Tiller Kubernetes Cluster\u4e0a\u3067\u7a3c\u50cd\u3059\u308bHelm\u30b5\u30fc\u30d0 Release Chart\u3092\u30c7\u30d7\u30ed\u30a4\u3057\u305f\u5358\u4f4d RBAC # \u524d\u56de\u306e christina04.hatenablog.com \u3067RBAC\u306b\u3064\u3044\u3066\u66f8\u304d\u307e\u3057\u305f\u304c\u3001helm\u306etiller\u304c api -server\u3092\u53e9\u304f\u306e\u3067\u6a29\u9650\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002 Namespace\u306e\u7528\u610f # \u4eca\u56de\u306f\u5c02\u7528\u306eNamespace\u3092\u7528\u610f\u3057\u3066\u304a\u304d\u307e\u3059\u3002 $ kubectl create namespace helm ServiceAccount\u4f5c\u6210 # apiVersion : v1 kind : ServiceAccount metadata : name : tiller namespace : helm ClusterRoleBinding # apiVersion : rbac . authorization . k8s . io / v1 kind : ClusterRoleBinding metadata : name : tiller roleRef : apiGroup : rbac . authorization . k8s . io kind : ClusterRole name : cluster - admin subjects : - kind : ServiceAccount name : tiller namespace : helm Tiller\u306e\u8d77\u52d5 # \u5148\u307b\u3069\u306eServiceAccount\u3092\u4f7f\u3044\u3001 helm init \u3067Tiller Server\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002 $ helm init --tiller-namespace helm --service-account tiller \u78ba\u8a8d\u3057\u307e\u3059\u3002 $ helm version --tiller-namespace helm Client: & version.Version { SemVer: \"v2.14.3\" , GitCommit: \"0e7f3b6637f7af8fcfddb3d2941fcc7cbebb0085\" , GitTreeState: \"clean\" } Server: & version.Version { SemVer: \"v2.14.3\" , GitCommit: \"0e7f3b6637f7af8fcfddb3d2941fcc7cbebb0085\" , GitTreeState: \"clean\" } helm\u3067prometheus\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb # Release\u540d\u3092 test-prometheus \u3068\u3057\u3066\u30c7\u30d7\u30ed\u30a4\u3057\u307e\u3059\u3002 $ helm install --tiller-namespace helm --name test-prometheus stable/prometheus \u554f\u984c\u306a\u304f\u4f5c\u6210\u3067\u304d\u307e\u3059\u3002 $ kubectl get po NAME READY STATUS RESTARTS AGE test-prometheus-alertmanager-6fb8c4d7f-6l77z 2 /2 Running 0 84s test-prometheus-kube-state-metrics-948cdb5f6-xvlll 1 /1 Running 0 84s test-prometheus-node-exporter-5xwx6 1 /1 Running 0 84s test-prometheus-pushgateway-6c4f8f8d6-rwjbf 1 /1 Running 0 84s test-prometheus-server-7c9c9f7b9f-22v8g 2 /2 Running 0 84s \u5404\u30b3\u30de\u30f3\u30c9 # \u7c21\u5358\u306e\u305f\u3081tiller-namespace\u3092 \u74b0\u5883\u5909\u6570 \u3067\u8a2d\u5b9a\u3057\u3066\u304a\u304d\u307e\u3059\u3002 $ export TILLER_NAMESPACE = helm \u4e00\u89a7 # $ helm list NAME REVISION UPDATED STATUS CHART APP VERSION NAMESPACE test-prometheus 1 Tue Aug 6 20 :31:14 2019 DEPLOYED prometheus-8.11.4 2 .9.2 default \u3053\u306e REVISION \u306fupgrade\u3084rollback\u3059\u308b\u969b\u306b\u7e70\u308a\u4e0a\u304c\u3063\u3066\u3044\u304d\u307e\u3059\u3002 \u30b9\u30c6\u30fc\u30bf\u30b9\u78ba\u8a8d # $ helm status test-prometheus LAST DEPLOYED: Tue Aug 6 23 :26:25 2019 NAMESPACE: default STATUS: DEPLOYED RESOURCES: == > v1/ConfigMap NAME DATA AGE test-prometheus-alertmanager 1 17s test-prometheus-server 3 17s ... \u524a\u9664 # delete\u3067\u524a\u9664\u3057\u307e\u3059\u304c\u3001 $ helm delete test-prometheus release \"test-prometheus\" deleted \u5b9f\u306fRelease\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u304c DELETED \u306b\u306a\u308b\u3060\u3051\u3067\u6b8b\u3063\u3066\u3044\u307e\u3059\u3002 $ helm status test-prometheus LAST DEPLOYED: Tue Aug 6 20 :31:14 2019 NAMESPACE: default STATUS: DELETED pod\u306a\u3069\u306e\u30ea\u30bd\u30fc\u30b9\u306f\u524a\u9664\u3055\u308c\u3066\u307e\u3059\u3002 \u30ed\u30fc\u30eb\u30d0\u30c3\u30af # REVISION \u3092\u6307\u5b9a\u3057\u3066 \u30ed\u30fc\u30eb\u30d0\u30c3\u30af \u3057\u307e\u3059\u3002 $ helm rollback test-prometheus 1 Rollback was a success. \u30ed\u30fc\u30eb\u30d0\u30c3\u30af \u3057\u305f\u306e\u3067 REVISION \u304c\u4e0a\u304c\u3063\u3066\u307e\u3059\u3002 $ helm list NAME REVISION UPDATED STATUS CHART APP VERSION NAMESPACE test-prometheus 2 Tue Aug 6 23 :26:25 2019 DEPLOYED prometheus-8.11.4 2 .9.2 default upgrade # fetch \u3067Chart\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066 $ helm fetch stable/prometheus \u5c55\u958b\u3057\u3066\u30d5\u30a1\u30a4\u30eb\u3092\u3044\u3058\u3063\u3066\u304b\u3089 upgrade \u3057\u307e\u3059\u3002 $ helm upgrade test-prometheus prometheus/ Release \"test-prometheus\" has been upgraded. LAST DEPLOYED: Tue Aug 6 23 :42:23 2019 NAMESPACE: default STATUS: DEPLOYED \u5b8c\u5168\u524a\u9664 # \\--purge \u3092\u3064\u3051\u308b\u3068\u5b8c\u5168\u306b\u6d88\u3048\u307e\u3059\u3002 $ helm delete --purge test-prometheus \u901a\u5e38RBAC\u306e\u30a8\u30e9\u30fc\u306f\u3069\u3093\u306a\u306e\uff1f # RBAC\u304c\u6709\u52b9\u306a\u74b0\u5883\u306e\u5834\u5408\u3001\u6b63\u3057\u3044ServiceAccount\u3092\u7528\u610f\u3057\u306a\u3044\u3068\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u304c\u51fa\u307e\u3059\u3002 $ helm install --name test-prometheus stable/prometheus Error: release test-prometheus failed: namespaces \"default\" is forbidden: User \"system:serviceaccount:kube-system:default\" cannot get resource \"namespaces\" in API group \"\" in the namespace \"default\" --tiller-namespace\u304c\u9762\u5012\u304f\u3055\u3044 # helm\u306eTiller Server\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u306enamespace\u306f Helm will look for Tiller in the kube-system namespace unless \\--tiller-namespace or TILLER_NAMESPACE is set. ref: Helm | \u3068\u3042\u308b\u3088\u3046\u306b\u3001 kube-system \u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002 \u306a\u306e\u3067 kube-system:default \u306eServiceAccount\u306bClusterRoleBinding\u3092\u8a2d\u5b9a\u3059\u308c\u3070\u4e0d\u8981\u306b\u306a\u308a\u307e\u3059\u3002 apiVersion : rbac . authorization . k8s . io / v1 kind : ClusterRoleBinding metadata : name : tiller roleRef : apiGroup : rbac . authorization . k8s . io kind : ClusterRole name : cluster - admin subjects : - kind : ServiceAccount name : default namespace : kube - system \u3082\u3061\u308d\u3093\u5148\u7a0b\u306e\u3088\u3046\u306b \u74b0\u5883\u5909\u6570 TILLER_NAMESPACE \u3067\u8a2d\u5b9a\u3059\u308b\u306e\u3082\uff11\u3064\u3067\u3059\u3002 minikube\u306e\u5834\u5408RBAC\u306eServiceAccount\u4e0d\u8981 # minikube\u306e\u5834\u5408\u3001helm\u304c\u6271\u3044\u3084\u3059\u3044\u3088\u3046 minikube-rbac \u3068\u3044\u3046ClusterRoleBinding\u304c\u5b58\u5728\u3057\u307e\u3059\u3002 $ kubectl get clusterrolebinding minikube-rbac -o yaml apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: creationTimestamp: \"2019-08-06T10:57:51Z\" name: minikube-rbac resourceVersion: \"237\" selfLink: /apis/rbac.authorization.k8s.io/v1/clusterrolebindings/minikube-rbac uid: a7210a35-4d6a-4c18-bd6d-15e72f5fbb8a roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: cluster-admin subjects: - kind: ServiceAccount name: default namespace: kube-system \u3053\u308c\u306f kube-sysmte:default \u306b cluster-admin \u6a29\u9650\u3092\u4ed8\u4e0e\u3057\u3066\u308b\u306e\u3067\u7279\u306b\u8a2d\u5b9a\u3057\u306a\u304f\u3066\u3082helm\u304c\u81ea\u7531\u306b\u4f7f\u3048\u307e\u3059\u3002 Docker for Mac \u306e\u5834\u5408\u3082RBAC\u8a2d\u5b9a\u4e0d\u8981 # Kubernetes \u306eRBAC\u3092\u7406\u89e3\u3059\u308b - Carpe Diem \u3067\u66f8\u3044\u305f\u3088\u3046\u306b default : default \u542b\u3080\u5168\u3066\u306eServiceAccount\u306bcluster-admin\u6a29\u9650\u304c\u3042\u308b\u306e\u3067\u4e0d\u8981\u3067\u3059\u3002 \u4eca\u56de\u4f7f\u7528\u3057\u305f\u30b3\u30fc\u30c9\u306f\u3053\u3061\u3089 github.com","title":"Helm"},{"location":"concepts/kubernetes/helm/#helm","text":"Kubernetes \u306e\u554f\u984c\u306e\uff11\u3064\u306b\u3001 \u30de\u30cb\u30d5\u30a7\u30b9\u30c8 \u30d5\u30a1\u30a4\u30eb\u304c\u305f\u304f\u3055\u3093\u3067\u304d\u308b YAML\u306e\u58c1 \u3068\u547c\u3070\u308c\u308b\u3082\u306e\u304c\u3042\u308a\u307e\u3059\u3002 image mount\u3059\u308b\u30d5\u30a1\u30a4\u30eb label \u30ea\u30bd\u30fc\u30b9\u5272\u5f53 \u3068\u3044\u3063\u305f\u4e00\u90e8\u306e\u8981\u7d20\u3060\u3051\u5909\u3048\u305f\u3044\u6642\u3001\u307b\u3068\u3093\u3069\u69cb\u6210\u306f\u540c\u3058\u3067\u4f3c\u305f\u3088\u3046\u306a \u30de\u30cb\u30d5\u30a7\u30b9\u30c8 \u30d5\u30a1\u30a4\u30eb\u304c\u5927\u91cf\u306b\u51fa\u3066\u3057\u307e\u3044\u307e\u3059\u3002 \u305d\u3057\u3066\u305d\u3046\u3044\u3063\u305f\u30d5\u30a1\u30a4\u30eb\u306f\u5f80\u3005\u306b\u3057\u3066\u7ba1\u7406\u3055\u308c\u305a\u8ca0\u50b5\u3068\u306a\u3063\u3066\u3044\u304d\u307e\u3059\u3002 \u305d\u308c\u3092\u89e3\u6c7a\u3059\u308b\u306e\u304cHelm\u3068\u3044\u3046 Kubernetes \u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u30de\u30cd\u30fc\u30b8\u30e3\u3067\u3059\u3002 \u5171\u901a\u90e8\u5206\u3092\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u5316\u3057\u3001\u53ef\u5909\u90e8\u5206\u3092\u5909\u6570\u3067\u6271\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002 \u4eca\u56de\u306f\u305d\u306eHelm\u306e\u57fa\u672c\u7684\u306a\u4f7f\u3044\u65b9\u3092\u8aac\u660e\u3057\u307e\u3059\u3002 Helm\u3092\u30b7\u30b9\u30c6\u30e0 \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3 \u306f\u4ee5\u4e0b\u3067\u3059\u3002 ref: Simplifying App Deployment in Kubernetes with Helm Charts \u56f3\u304b\u3089\u308f\u304b\u308b\u3088\u3046\u306bTiller\u3068\u547c\u3070\u308c\u308b\u30b5\u30fc\u30d0\u304c Kubernetes Cluster\u5185\u3067\u8d77\u52d5\u3057\u3001 api -server\u3092\u30b3\u30fc\u30eb\u3057\u3066\u30c7\u30d7\u30ed\u30a4\u3092\u884c\u3044\u307e\u3059\u3002 \u899a\u3048\u3066\u304a\u3044\u305f\u65b9\u304c\u3088\u3044\u5358\u8a9e\u306f\u4ee5\u4e0b\u3067\u3059\u3002 \u7528\u8a9e \u8aac\u660e Chart Helm\u3067\u5229\u7528\u3059\u308b\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8 Tiller Kubernetes Cluster\u4e0a\u3067\u7a3c\u50cd\u3059\u308bHelm\u30b5\u30fc\u30d0 Release Chart\u3092\u30c7\u30d7\u30ed\u30a4\u3057\u305f\u5358\u4f4d","title":"Helm \u306e\u57fa\u672c\u7684\u306a\u4f7f\u3044\u65b9"},{"location":"concepts/kubernetes/helm/#rbac","text":"\u524d\u56de\u306e christina04.hatenablog.com \u3067RBAC\u306b\u3064\u3044\u3066\u66f8\u304d\u307e\u3057\u305f\u304c\u3001helm\u306etiller\u304c api -server\u3092\u53e9\u304f\u306e\u3067\u6a29\u9650\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002","title":"RBAC"},{"location":"concepts/kubernetes/helm/#namespace","text":"\u4eca\u56de\u306f\u5c02\u7528\u306eNamespace\u3092\u7528\u610f\u3057\u3066\u304a\u304d\u307e\u3059\u3002 $ kubectl create namespace helm","title":"Namespace\u306e\u7528\u610f"},{"location":"concepts/kubernetes/helm/#serviceaccount","text":"apiVersion : v1 kind : ServiceAccount metadata : name : tiller namespace : helm","title":"ServiceAccount\u4f5c\u6210"},{"location":"concepts/kubernetes/helm/#clusterrolebinding","text":"apiVersion : rbac . authorization . k8s . io / v1 kind : ClusterRoleBinding metadata : name : tiller roleRef : apiGroup : rbac . authorization . k8s . io kind : ClusterRole name : cluster - admin subjects : - kind : ServiceAccount name : tiller namespace : helm","title":"ClusterRoleBinding"},{"location":"concepts/kubernetes/helm/#tiller","text":"\u5148\u307b\u3069\u306eServiceAccount\u3092\u4f7f\u3044\u3001 helm init \u3067Tiller Server\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002 $ helm init --tiller-namespace helm --service-account tiller \u78ba\u8a8d\u3057\u307e\u3059\u3002 $ helm version --tiller-namespace helm Client: & version.Version { SemVer: \"v2.14.3\" , GitCommit: \"0e7f3b6637f7af8fcfddb3d2941fcc7cbebb0085\" , GitTreeState: \"clean\" } Server: & version.Version { SemVer: \"v2.14.3\" , GitCommit: \"0e7f3b6637f7af8fcfddb3d2941fcc7cbebb0085\" , GitTreeState: \"clean\" }","title":"Tiller\u306e\u8d77\u52d5"},{"location":"concepts/kubernetes/helm/#helmprometheus","text":"Release\u540d\u3092 test-prometheus \u3068\u3057\u3066\u30c7\u30d7\u30ed\u30a4\u3057\u307e\u3059\u3002 $ helm install --tiller-namespace helm --name test-prometheus stable/prometheus \u554f\u984c\u306a\u304f\u4f5c\u6210\u3067\u304d\u307e\u3059\u3002 $ kubectl get po NAME READY STATUS RESTARTS AGE test-prometheus-alertmanager-6fb8c4d7f-6l77z 2 /2 Running 0 84s test-prometheus-kube-state-metrics-948cdb5f6-xvlll 1 /1 Running 0 84s test-prometheus-node-exporter-5xwx6 1 /1 Running 0 84s test-prometheus-pushgateway-6c4f8f8d6-rwjbf 1 /1 Running 0 84s test-prometheus-server-7c9c9f7b9f-22v8g 2 /2 Running 0 84s","title":"helm\u3067prometheus\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb"},{"location":"concepts/kubernetes/helm/#_1","text":"\u7c21\u5358\u306e\u305f\u3081tiller-namespace\u3092 \u74b0\u5883\u5909\u6570 \u3067\u8a2d\u5b9a\u3057\u3066\u304a\u304d\u307e\u3059\u3002 $ export TILLER_NAMESPACE = helm","title":"\u5404\u30b3\u30de\u30f3\u30c9"},{"location":"concepts/kubernetes/helm/#_2","text":"$ helm list NAME REVISION UPDATED STATUS CHART APP VERSION NAMESPACE test-prometheus 1 Tue Aug 6 20 :31:14 2019 DEPLOYED prometheus-8.11.4 2 .9.2 default \u3053\u306e REVISION \u306fupgrade\u3084rollback\u3059\u308b\u969b\u306b\u7e70\u308a\u4e0a\u304c\u3063\u3066\u3044\u304d\u307e\u3059\u3002","title":"\u4e00\u89a7"},{"location":"concepts/kubernetes/helm/#_3","text":"$ helm status test-prometheus LAST DEPLOYED: Tue Aug 6 23 :26:25 2019 NAMESPACE: default STATUS: DEPLOYED RESOURCES: == > v1/ConfigMap NAME DATA AGE test-prometheus-alertmanager 1 17s test-prometheus-server 3 17s ...","title":"\u30b9\u30c6\u30fc\u30bf\u30b9\u78ba\u8a8d"},{"location":"concepts/kubernetes/helm/#_4","text":"delete\u3067\u524a\u9664\u3057\u307e\u3059\u304c\u3001 $ helm delete test-prometheus release \"test-prometheus\" deleted \u5b9f\u306fRelease\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u304c DELETED \u306b\u306a\u308b\u3060\u3051\u3067\u6b8b\u3063\u3066\u3044\u307e\u3059\u3002 $ helm status test-prometheus LAST DEPLOYED: Tue Aug 6 20 :31:14 2019 NAMESPACE: default STATUS: DELETED pod\u306a\u3069\u306e\u30ea\u30bd\u30fc\u30b9\u306f\u524a\u9664\u3055\u308c\u3066\u307e\u3059\u3002","title":"\u524a\u9664"},{"location":"concepts/kubernetes/helm/#_5","text":"REVISION \u3092\u6307\u5b9a\u3057\u3066 \u30ed\u30fc\u30eb\u30d0\u30c3\u30af \u3057\u307e\u3059\u3002 $ helm rollback test-prometheus 1 Rollback was a success. \u30ed\u30fc\u30eb\u30d0\u30c3\u30af \u3057\u305f\u306e\u3067 REVISION \u304c\u4e0a\u304c\u3063\u3066\u307e\u3059\u3002 $ helm list NAME REVISION UPDATED STATUS CHART APP VERSION NAMESPACE test-prometheus 2 Tue Aug 6 23 :26:25 2019 DEPLOYED prometheus-8.11.4 2 .9.2 default","title":"\u30ed\u30fc\u30eb\u30d0\u30c3\u30af"},{"location":"concepts/kubernetes/helm/#upgrade","text":"fetch \u3067Chart\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066 $ helm fetch stable/prometheus \u5c55\u958b\u3057\u3066\u30d5\u30a1\u30a4\u30eb\u3092\u3044\u3058\u3063\u3066\u304b\u3089 upgrade \u3057\u307e\u3059\u3002 $ helm upgrade test-prometheus prometheus/ Release \"test-prometheus\" has been upgraded. LAST DEPLOYED: Tue Aug 6 23 :42:23 2019 NAMESPACE: default STATUS: DEPLOYED","title":"upgrade"},{"location":"concepts/kubernetes/helm/#_6","text":"\\--purge \u3092\u3064\u3051\u308b\u3068\u5b8c\u5168\u306b\u6d88\u3048\u307e\u3059\u3002 $ helm delete --purge test-prometheus","title":"\u5b8c\u5168\u524a\u9664"},{"location":"concepts/kubernetes/helm/#rbac_1","text":"RBAC\u304c\u6709\u52b9\u306a\u74b0\u5883\u306e\u5834\u5408\u3001\u6b63\u3057\u3044ServiceAccount\u3092\u7528\u610f\u3057\u306a\u3044\u3068\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u304c\u51fa\u307e\u3059\u3002 $ helm install --name test-prometheus stable/prometheus Error: release test-prometheus failed: namespaces \"default\" is forbidden: User \"system:serviceaccount:kube-system:default\" cannot get resource \"namespaces\" in API group \"\" in the namespace \"default\"","title":"\u901a\u5e38RBAC\u306e\u30a8\u30e9\u30fc\u306f\u3069\u3093\u306a\u306e\uff1f"},{"location":"concepts/kubernetes/helm/#45-tiller-namespace","text":"helm\u306eTiller Server\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u306enamespace\u306f Helm will look for Tiller in the kube-system namespace unless \\--tiller-namespace or TILLER_NAMESPACE is set. ref: Helm | \u3068\u3042\u308b\u3088\u3046\u306b\u3001 kube-system \u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002 \u306a\u306e\u3067 kube-system:default \u306eServiceAccount\u306bClusterRoleBinding\u3092\u8a2d\u5b9a\u3059\u308c\u3070\u4e0d\u8981\u306b\u306a\u308a\u307e\u3059\u3002 apiVersion : rbac . authorization . k8s . io / v1 kind : ClusterRoleBinding metadata : name : tiller roleRef : apiGroup : rbac . authorization . k8s . io kind : ClusterRole name : cluster - admin subjects : - kind : ServiceAccount name : default namespace : kube - system \u3082\u3061\u308d\u3093\u5148\u7a0b\u306e\u3088\u3046\u306b \u74b0\u5883\u5909\u6570 TILLER_NAMESPACE \u3067\u8a2d\u5b9a\u3059\u308b\u306e\u3082\uff11\u3064\u3067\u3059\u3002","title":"--tiller-namespace\u304c\u9762\u5012\u304f\u3055\u3044"},{"location":"concepts/kubernetes/helm/#minikuberbacserviceaccount","text":"minikube\u306e\u5834\u5408\u3001helm\u304c\u6271\u3044\u3084\u3059\u3044\u3088\u3046 minikube-rbac \u3068\u3044\u3046ClusterRoleBinding\u304c\u5b58\u5728\u3057\u307e\u3059\u3002 $ kubectl get clusterrolebinding minikube-rbac -o yaml apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: creationTimestamp: \"2019-08-06T10:57:51Z\" name: minikube-rbac resourceVersion: \"237\" selfLink: /apis/rbac.authorization.k8s.io/v1/clusterrolebindings/minikube-rbac uid: a7210a35-4d6a-4c18-bd6d-15e72f5fbb8a roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: cluster-admin subjects: - kind: ServiceAccount name: default namespace: kube-system \u3053\u308c\u306f kube-sysmte:default \u306b cluster-admin \u6a29\u9650\u3092\u4ed8\u4e0e\u3057\u3066\u308b\u306e\u3067\u7279\u306b\u8a2d\u5b9a\u3057\u306a\u304f\u3066\u3082helm\u304c\u81ea\u7531\u306b\u4f7f\u3048\u307e\u3059\u3002","title":"minikube\u306e\u5834\u5408RBAC\u306eServiceAccount\u4e0d\u8981"},{"location":"concepts/kubernetes/helm/#docker-for-macrbac","text":"Kubernetes \u306eRBAC\u3092\u7406\u89e3\u3059\u308b - Carpe Diem \u3067\u66f8\u3044\u305f\u3088\u3046\u306b default : default \u542b\u3080\u5168\u3066\u306eServiceAccount\u306bcluster-admin\u6a29\u9650\u304c\u3042\u308b\u306e\u3067\u4e0d\u8981\u3067\u3059\u3002 \u4eca\u56de\u4f7f\u7528\u3057\u305f\u30b3\u30fc\u30c9\u306f\u3053\u3061\u3089 github.com","title":"Docker for Mac\u306e\u5834\u5408\u3082RBAC\u8a2d\u5b9a\u4e0d\u8981"},{"location":"guides/pdb/","text":"OS \u306e\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3084\u30b9\u30b1\u30fc\u30eb\u30c0\u30a6\u30f3\u306a\u3069\u3067\u8907\u6570\u306e Node \u3092\u5b89\u5168\u306b\u505c\u6b62\u3057\u305f\u3044\u5834\u5408\u306e\u30e1\u30e2\u3067\u3059\u3002\u3053\u306e\u8a18\u4e8b\u306f Kubernetes 1.7.3 \u3067\u78ba\u8a8d\u3057\u305f\u60c5\u5831\u3092\u5143\u306b\u8a18\u8f09\u3057\u3066\u3044\u307e\u3059\u3002 TL;DR # Node \u3092\u505c\u6b62\u3059\u308b\u305f\u3081\u306b\u306fkubectl drain \u30b3\u30de\u30f3\u30c9\u3092\u5229\u7528\u3057\u3066\u505c\u6b62\u6e96\u5099\u3092\u884c\u3044\u307e\u3059 drain \u306f Node \u3092 Pod \u306e\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u5bfe\u8c61\u304b\u3089\u5916\u3057 (unschedulable \u306b\u8a2d\u5b9a) Node \u4e0a\u306e Pod \u3092\u9000\u53bb\u3055\u305b\u308b\u3053\u3068\u3067\u505c\u6b62\u53ef\u80fd\u306a\u72b6\u614b\u306b\u3057\u307e\u3059 \u3057\u304b\u3057\u8907\u6570\u306e Node \u3092\u505c\u6b62\u3055\u305b\u308b\u5834\u5408\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e Pod \u304c\u4e00\u3064\u3082\u52d5\u4f5c\u3057\u3066\u3044\u306a\u3044\u72b6\u614b (ready \u306a Pod \u304c 0)\u304c\u3042\u308a\u3048\u308b\u306e\u3067\u6ce8\u610f\u304c\u5fc5\u8981\u3067\u3059 PodDisruptionBudget \u3092\u5b9a\u7fa9\u3059\u308b\u3053\u3068\u3067\u5b89\u5168\u306a Pod \u6570\u3092\u4fdd\u3063\u305f\u307e\u307e\u8907\u6570 Node \u306e drain \u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059 \u5b89\u5168\u306a Pod \u6570\u304c\u78ba\u4fdd\u3067\u304d\u308b\u307e\u3067 kubectl drain \u304c Pod \u306e\u9000\u53bb\u3092\u5f85\u3063\u3066\u304f\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059 Node \u304b\u3089 Pod \u3092\u9000\u53bb\u3055\u305b\u308b (kubectl drain) # OS \u306e\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3084\u30b9\u30b1\u30fc\u30eb\u30c0\u30a6\u30f3\u306a\u3069\u3067 Node \u3092\u505c\u6b62\u3057\u305f\u3044\u5834\u5408\u3001\u305d\u306e Node \u306b\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b Pod \u306b\u9000\u53bb\u3057\u3066\u3082\u3089\u3046\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u306e\u64cd\u4f5c\u306f kubctl drain <NODE> \u3068\u3044\u3046\u30b3\u30de\u30f3\u30c9\u3067\u7c21\u5358\u306b\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002 \u4e0b\u8a18\u306e\u3088\u3046\u306b Node \u540d\u3092\u6307\u5b9a\u3057\u3066 kubectl drain \u3092\u5b9f\u884c\u3057\u307e\u3059\u3002 $ kubectl drain --ignore-daemonsets --force gke-cluster-2-default-pool-0fb8a591-71rf # Node \u304c unschedulable \u306b\u8a2d\u5b9a\u3055\u308c\u308b (kubectl cordon \u3068\u540c\u7b49) node \"gke-cluster-2-default-pool-0fb8a591-71rf\" cordoned WARNING: Deleting pods not managed by ReplicationController, ReplicaSet, Job, DaemonSet or StatefulSet: kube-proxy-gke-cluster-2-default-pool-0fb8a591-71rf ; Ignoring DaemonSet-managed pods: fluentd-gcp-v2.0-tt6mf # \u3053\u306e Node \u306b\u3042\u308b Pod \u304c\u9000\u53bb\u3055\u305b\u3089\u308c\u3066\u3044\u304f pod \"myapp-1243928920-bz02h\" evicted pod \"heapster-v1.4.0-1718439912-xmg0k\" evicted # drain \u304c\u5b8c\u4e86 node \"gke-cluster-2-default-pool-0fb8a591-71rf\" drained \u30ce\u30fc\u30c9\u304c\u6b63\u3057\u304f SchedulingDisabled (unschedulable) \u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\u52d5\u4f5c\u4e2d\u306e Pod \u304c\u306a\u304f\u306a\u308a\u3001\u65b0\u305f\u306b Pod \u304c\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3055\u308c\u308b\u3053\u3068\u3082\u306a\u3044\u305f\u3081\u3001\u3053\u306e\u30ce\u30fc\u30c9\u306f\u505c\u6b62\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002 $ kubectl get nodes NAME STATUS AGE VERSION gke-cluster-2-default-pool-0fb8a591-71rf Ready,SchedulingDisabled 20m v1.7.3 # SchedulingDisabled \u306b\u306a\u3063\u305f gke-cluster-2-default-pool-0fb8a591-cmcl Ready 20m v1.7.3 gke-cluster-2-default-pool-0fb8a591-d6pn Ready 20m v1.7.3 gke-cluster-2-default-pool-0fb8a591-n1sr Ready 20m v1.7.3 kubectl drain \u306e\u52d5\u4f5c # kubectl drain \u3067\u306f\u4e3b\u306b\u4ee5\u4e0b\u306e\u51e6\u7406\u304c\u884c\u308f\u308c\u3066\u3044\u307e\u3059\u3002 Node \u306b\u65b0\u898f Pod \u304c\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3055\u308c\u306a\u3044\u3088\u3046\u306b unschedulable \u306e\u8a2d\u5b9a\u3092\u884c\u3046 Node \u306b\u7d10\u4ed8\u3051\u3089\u308c\u3066\u3044\u308b Pod \u4e00\u89a7\u3092\u53d6\u5f97\u3057\u3066\u3001Pod \u7fa4\u306b\u9000\u53bb (evict) \u306e\u51e6\u7406\u304c\u884c\u308f\u308c\u308b \u8a73\u3057\u304f\u306f\u5f8c\u8ff0\u306e Eviction API \u3092\u3054\u89a7\u304f\u3060\u3055\u3044 evict \u304c\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u306a\u3044\u5834\u5408(\u65e7\u30d0\u30fc\u30b8\u30e7\u30f3\u306e API Server \u306a\u3069)\u306f\u5358\u306b\u524a\u9664\u51e6\u7406\u306b\u306a\u308b \u52d5\u4f5c\u4f8b # \u4f8b\u3048\u3070 Node \u304c 4\u53f0\u3042\u308a\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b myapp \u3068\u3044\u3046\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c 2 \u3064\u306e\u30ce\u30fc\u30c9\u306b\u3042\u308b\u72b6\u614b\u3060\u3068\u3057\u307e\u3059\u3002myapp \u306f ReplicaSet (\u30ec\u30d7\u30ea\u30ab\u6570 2) \u3067\u7ba1\u7406\u3055\u308c\u3066\u3044\u308b\u3068\u3057\u307e\u3059\u3002 node-1 \u306b\u5bfe\u3057\u3066 kubectl drain \u3092\u884c\u3046\u3068\u3001\u4e0b\u8a18\u306e\u3088\u3046\u306a\u9806\u5e8f\u3067\u51e6\u7406\u304c\u884c\u308f\u308c\u307e\u3059\u3002 node-1 \u3092 unschedulrable \u306b\u8a2d\u5b9a node-1 \u306b\u5272\u308a\u5f53\u3066\u3089\u308c\u305f Pod (\u3053\u3053\u3067\u306f myapp-1) \u304c\u9000\u53bb(evict)\u3055\u305b\u3089\u308c\u307e\u3059 PodDisruptionBudget \u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u306a\u3044\u5834\u5408\u3001\u9000\u53bb(evict) \u306f\u5358\u7d14\u306b Pod \u304c\u524a\u9664\u3055\u308c\u307e\u3059 kubectl \u306e drain \u306f\u3053\u3053\u3067\u7d42\u4e86\u3057\u307e\u3059 ReplicaSet \u306e\u50cd\u304d\u306b\u3088\u3063\u3066 node-3 \u306b\u65b0\u305f\u306b Pod \u304c\u4f5c\u6210\u3055\u308c\u3001\u30ec\u30d7\u30ea\u30ab\u6570 2 \u304c\u4fdd\u305f\u308c\u307e\u3059\u3002 \u6ce8\u610f\u304c\u5fc5\u8981\u306a\u5834\u5408 # \u7d9a\u3051\u3066 node-2 \u3092 drain \u3057\u305f\u3044\u5834\u5408\u6ce8\u610f\u304c\u5fc5\u8981\u3067\u3059\u3002\u65b0\u3057\u304f\u4f5c\u6210\u3055\u308c\u305f myapp-3 \u306e Pod \u4f5c\u6210\u306b\u6642\u9593\u304c\u304b\u304b\u3063\u305f\u5834\u5408\u306f\u3001node-2 \u3092 drain \u3059\u308b\u3053\u3068\u306b\u3088\u3063\u3066\u4e00\u3064\u3082 Pod \u304c ready \u306b\u306a\u3063\u3066\u3044\u306a\u3044\u72b6\u6cc1\u304c\u8d77\u3053\u308a\u5f97\u307e\u3059\u3002 PodDisruptionBudget \u306b\u3088\u308b\u5b89\u5168\u306a drain # PodDisruptionBudget \u3068\u306f Node \u3092\u8a08\u753b\u7684\u306b\u505c\u6b62\u3057\u305f\u3044\u5834\u5408\u306b\u3001Pod \u306e\u72b6\u6cc1\u3092\u898b\u306a\u304c\u3089\u9000\u53bb (evict) \u3055\u305b\u308b\u6a5f\u80fd\u3067\u3059\u3002\u57fa\u672c\u7684\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306f ReplicaSet \u306b\u3088\u3063\u3066\u8907\u6570\u306e Pod \u304c\u4fdd\u6301\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u5197\u9577\u6027\u304c\u3042\u308b\u3068\u8003\u3048\u3089\u308c\u307e\u3059\u3002PodDisruptionBudget \u306f\u505c\u6b62\u72b6\u614b (Disruption) \u3068\u3057\u3066\u8a31\u5bb9\u3067\u304d\u308b Pod \u6570\u3092\u4e88\u7b97 (Budget) \u3068\u3057\u3066\u5b9a\u7fa9\u3057\u3066\u3001\u305d\u306e\u4e88\u7b97\u5185\u3067\u9000\u53bb\u3055\u305b\u3066\u3044\u304d\u307e\u3059\u3002( Error Budget \u7684\u306a\u540d\u524d\u3067\u6d12\u843d\u3066\u3044\u307e\u3059\u306d)\u3002 PodDiruptionBudget \u3067\u306f\u4ee5\u4e0b\u306e\u3069\u3061\u3089\u304b\u306e\u8a2d\u5b9a\u304c\u53ef\u80fd\u3067\u3059\u3002 .spec.minAvailable : \u5c11\u306a\u304f\u3068\u3082\u6709\u52b9\u3067\u3042\u308b\u3079\u304d Pod \u6570\u3002\u30d1\u30fc\u30bb\u30f3\u30c6\u30fc\u30b8\u306b\u3088\u308b\u6307\u5b9a\u3082\u53ef\u80fd .spec.maxUnavailable : \u6700\u5927\u7121\u52b9\u3067\u3042\u3063\u3066\u3082\u3088\u3044 Pod \u6570\u3002\u30d1\u30fc\u30bb\u30f3\u30c6\u30fc\u30b8\u306b\u3088\u308b\u6307\u5b9a\u3082\u53ef\u80fd (v1.7 \u4ee5\u4e0a\u3067\u5229\u7528\u53ef\u80fd) \u4ee5\u4e0b\u306e\u3088\u3046\u306b PodDisruptionBudget \u30ea\u30bd\u30fc\u30b9\u3092\u5b9a\u7fa9\u3057\u3066\u5229\u7528\u3057\u307e\u3059\u3002 kubectl create poddisruptionbudget \u3068\u3044\u3046\u30b5\u30d6\u30b3\u30de\u30f3\u30c9\u306b\u3088\u308b\u4f5c\u6210\u3082\u53ef\u80fd\u3067\u3059\u3002 apiVersion : policy/v1beta1 kind : PodDisruptionBudget metadata : name : myapp spec : # \u6700\u5927\u3067\u7121\u52b9\u72b6\u614b\u306a Pod \u306f 1 \u306b\u8a2d\u5b9a\u3002\u3053\u308c\u3092\u8d85\u3048\u3066\u306f\u9000\u53bb\u3055\u305b\u3089\u308c\u306a\u3044 maxUnavailable : 1 # \u5bfe\u8c61 Pod \u306e\u30bb\u30ec\u30af\u30bf selector : matchLabels : run : myapp \u3053\u308c\u3092\u8a2d\u5b9a\u3059\u308b\u3068\u524d\u8ff0\u306e\u4f8b\u306e Node-2 \u306e\u9000\u53bb\u306f\u4ee5\u4e0b\u306e\u52d5\u4f5c\u306b\u306a\u308a\u307e\u3059\u3002 node-2 \u3092 unschedulrable \u306b\u8a2d\u5b9a node-2 \u306b\u5272\u308a\u5f53\u3066\u3089\u308c\u305f Pod (\u3053\u3053\u3067\u306f myapp-1) \u3092\u9000\u53bb(evict)\u3057\u3088\u3046\u3068\u3059\u308b \u3059\u3067\u306b unavailable \u306e Pod \u304c\u3042\u308a PodDisruptionBudget \u3092\u8d85\u3048\u3066\u3057\u307e\u3046\u305f\u3081\u9000\u53bb\u3092\u5f85\u3061\u307e\u3059 (5 \u79d2\u9593\u9694\u3067\u30ea\u30c8\u30e9\u30a4) node-3 \u306e Pod \u304c ready \u306b\u306a\u308a PodDisruptionBudget \u3092\u6e80\u305f\u3059\u3088\u3046\u306b\u306a\u308b\u3068 node-2 \u306e Pod \u306f\u524a\u9664\u3055\u308c\u307e\u3059\u3002 PodDisruptionBudget \u306e\u72b6\u6cc1\u3092\u898b\u308b # PodDisruptionBudget \u30ea\u30bd\u30fc\u30b9\u306b\u306f\u7ba1\u7406\u3055\u308c\u3066\u3044\u308b Pod \u306e\u72b6\u614b\u304c\u8a18\u8ff0\u3055\u308c\u3066\u3044\u307e\u3059\u3002 kubectl get pdb \u3067\u8a2d\u5b9a\u72b6\u6cc1\u3068\u73fe\u5728\u505c\u6b62\u304c\u8a31\u5bb9\u3055\u308c\u308b Pod \u6570 ( ALLOWED-DISRUPTIONS ) \u3092\u898b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002 $ kubectl get pdb NAME MIN-AVAILABLE MAX-UNAVAILABLE ALLOWED-DISRUPTIONS AGE myapp N/A 1 1 2m \u8a73\u7d30\u306a\u72b6\u6cc1\u306f\u4e0b\u8a18\u306e\u3088\u3046\u306b\u898b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002 $ kubectl get pdb -o yaml myapp apiVersion : policy/v1beta1 kind : PodDisruptionBudget metadata : annotations : kubectl.kubernetes.io/last-applied-configuration : | {\"apiVersion\":\"policy/v1beta1\",\"kind\":\"PodDisruptionBudget\",\"metadata\":{\"annotations\":{},\"name\":\"myapp\",\"namespace\":\"default\"},\"spec\":{\"maxUnavailable\":1,\"selector\":{\"matchLabels\":{\"run\":\"myapp\"}}}} creationTimestamp : 2017-08-28T07:53:13Z generation : 1 name : myapp namespace : default resourceVersion : \"8859\" selfLink : /apis/policy/v1beta1/namespaces/default/poddisruptionbudgets/myapp uid : f14ed83b-8bc5-11e7-862c-42010af00125 spec : maxUnavailable : 1 selector : matchLabels : run : myapp status : # ready \u72b6\u614b\u306e Pod \u6570 currentHealthy : 10 # \u3053\u306e\u6570\u3092\u4e0b\u56de\u3063\u3066\u306f Evicton \u3067\u304d\u306a\u3044 desiredHealthy : 9 disruptedPods : null # \u73fe\u5728\u505c\u6b62\u304c\u8a31\u3055\u308c\u308b Pod \u6570\u3002currentHealthy - desiredHealthy \u3067\u8a08\u7b97\u3055\u308c\u308b disruptionsAllowed : 1 expectedPods : 10 observedGeneration : 1 \u88dc\u8db3: Eviction (\u9000\u907f) API # kubectl drain \u3067\u306f\u5185\u90e8\u7684\u306b\u306f Pod \u306e\u524a\u9664(DELETE)\u3067\u306f\u306a\u304f\u3001Eviction API \u3068\u3044\u3046 Pod \u306e\u30b5\u30d6\u30ea\u30bd\u30fc\u30b9\u3092\u547c\u3073\u51fa\u3057\u3066 Node \u306b\u7d10\u3065\u304f Pod \u306e\u9000\u907f\u3092\u884c\u3063\u3066\u3044\u307e\u3059\u3002Pod \u306e\u524a\u9664\u3068\u306e\u9055\u3044\u306f PodDiruptionBudget \u3092\u53c2\u7167\u3057\u4e88\u7b97\u3092\u6e80\u305f\u3055\u306a\u3044\u5834\u5408\u306f\u524a\u9664\u305b\u305a\u306b 429 Too Many Requests \u3092\u8fd4\u3059\u70b9\u3067\u3059\u3002 Eviction \u30b5\u30d6\u30ea\u30bd\u30fc\u30b9\u306f Pod \u306e\u30b5\u30d6\u30ea\u30bd\u30fc\u30b9\u3068\u3057\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002 /api/v1/namespaces/<NAMESPACE>/pods/<POD>/eviction \u3053\u306e API \u306b\u5bfe\u3057\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306a Eviction \u30b5\u30d6\u30ea\u30bd\u30fc\u30b9 \u3092 POST \u3057\u307e\u3059\u3002 { \"kind\" : \"Eviction\" , \"apiVersion\" : \"policy/v1beta1\" , \"metadata\" : { \"name\" : \"myapp-1243928920-bz02h\" , # POD \u540d \"namespace\" : \"default\" , \"creationTimestamp\" : null }, \"deleteOptions\" : {} } Eviction API \u306f PodDiruptionBudget \u3092\u53c2\u7167\u3057\u3001\u5b9a\u7fa9\u3057\u305f\u4e88\u7b97\u3092\u6e80\u305f\u3057\u3066\u3044\u308b\u5834\u5408\u306f Pod \u306e\u524a\u9664\u3057\u3066 HTTP \u306e 201 Created \u3001\u6e80\u305f\u3057\u3066\u3044\u306a\u3044\u5834\u5408\u306f\u524a\u9664\u305b\u305a HTTP \u306e 429 Too Many Requests \u3092\u8fd4\u3057\u307e\u3059\u3002 # kubectl \u306e verbose \u30ed\u30b0 I0828 14 :12:38.049411 29825 round_trippers.go:405 ] POST https://35.194.250.38/api/v1/namespaces/default/pods/myapp-1243928920-cpmcr/eviction 429 Too Many Requests in 39 milliseconds kubectl drain \u3067\u306f 429 Too Many Requests \u306e\u3068\u304d\u306f 5 \u79d2\u3054\u3068\u306b\u30ea\u30c8\u30e9\u30a4\u3059\u308b\u5b9f\u88c5\u306b\u306a\u3063\u3066\u304a\u308a\u3001\u4e88\u7b97\u3092\u6e80\u305f\u3059\u304b\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8( --timeout \u306e\u5024)\u306b\u306a\u308b\u307e\u3067\u5f85\u3061\u7d9a\u3051\u307e\u3059\u3002(\u53c2\u8003: drain.go#L500 ) PodDisruptionBudget \u306e\u52d5\u4f5c\u3092\u8a66\u3057\u3066\u307f\u308b # PodDisruptionBudget \u3092\u5b9f\u969b\u306b\u8a66\u3057\u3066\u307f\u307e\u3059\u3002\u3053\u3053\u3067\u306f ready \u306b\u306a\u308b\u307e\u3067\u306b\u6642\u9593\u304c\u304b\u304b\u308b(2\u5206)\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u30c7\u30d7\u30ed\u30a4\u3057\u3001maxUnavailable \u3092 1 \u306b\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002( \u4f7f\u7528\u3057\u305f Deployment \u3068 PodDisruptionBudget \u306e\u30de\u30cb\u30d5\u30a7\u30b9\u30c8 )\u3002\u4e0b\u8a18\u306e\u3088\u3046\u306b Pod \u304c 2 \u3064\u306e Node \u306b\u30c7\u30d7\u30ed\u30a4\u3055\u308c\u3066\u3044\u308b\u72b6\u614b\u304b\u3089\u59cb\u3081\u307e\u3059\u3002Node \u306f\u5168\u4f53\u3067 4 \u3064\u3042\u308a\u307e\u3059\u3002 $ kubectl get pods -o wide NAME READY STATUS RESTARTS AGE IP NODE myapp-1871887261-k5v4s 1 /1 Running 0 2m 10 .8.0.7 gke-cluster-1-default-pool-94337df7-lnc5 myapp-1871887261-x23z5 1 /1 Running 0 2m 10 .8.2.6 gke-cluster-1-default-pool-94337df7-sfp4 Pod \u304c\u30c7\u30d7\u30ed\u30a4\u3055\u308c\u3066\u3044\u308b 2 Node \u306b\u5bfe\u3057\u3066\u540c\u6642\u306b drain \u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002 $ kubectl drain --ignore-daemonsets --force gke-cluster-1-default-pool-94337df7-lnc5 $ kubectl drain --ignore-daemonsets --force gke-cluster-1-default-pool-94337df7-sfp4 ReplicaSet \u3092 watch \u3057\u3066 drain \u4e2d\u306e Pod \u306e\u72b6\u614b\u3092\u898b\u3066\u307e\u3059\u3002\u60f3\u5b9a\u3069\u304a\u308a PodDisruptionBudget \u306e\u304a\u304b\u3052\u3067 ready \u306e Pod \u304c\u5e38\u306b\u3042\u308b\u72b6\u614b\u3092\u4fdd\u3063\u3066\u3044\u307e\u3059\u3002Node \u306e\u4e00\u3064\u306f drain \u304c\u3059\u3050\u306b\u7d42\u308f\u308a\u3001\u3082\u3046\u4e00\u3064\u306e Node \u306f drain \u304c PodDisruptionBudget \u3067\u5b9a\u7fa9\u3057\u305f Pod \u306eready \u3092\u5f85\u3064\u305f\u3081\u306b\u7d04 2 \u5206\u9593\u304b\u304b\u308a\u307e\u3057\u305f\u3002 # DESIRED : ReplicaSet \u3067\u5b9a\u7fa9\u3057\u305f\u30ec\u30d7\u30ea\u30ab\u6570 # CURRENT : Pod \u6570 (\u30b9\u30c6\u30fc\u30bf\u30b9\u306f\u95a2\u4fc2\u306a\u3057) # READY : ready \u72b6\u614b\u306e Pod \u6570 $ kubectl get rs -w NAME DESIRED CURRENT READY AGE myapp-1871887261 2 2 2 3m # drain \u5b9f\u884c\u524d myapp-1871887261 2 1 1 3m # \u3072\u3068\u3064\u3081\u306e Node \u306e drain \u306b\u3088\u3063\u3066 Pod \u304c\u6e1b\u308b myapp-1871887261 2 2 1 3m # ReplicaSet \u306b\u3088\u3063\u3066 Pod \u304c\u5897\u3048\u308b\u304c ready \u306b\u306f\u306a\u3089\u306a\u3044 # ready \u3092\u5f85\u3064\u305f\u3081\u306b\u3053\u3053\u3067\u7d04 2\u5206\u9593\u304b\u304b\u308b myapp-1871887261 2 2 2 5m # 2 \u3064ready \u306b\u306a\u3063\u305f\u306e\u3067 \u3075\u305f\u3064\u3081\u306e Node \u3082 drain \u3067\u304d\u308b myapp-1871887261 2 1 1 5m # \u3075\u305f\u3064\u3081\u306e Node \u306e drain \u306b\u3088\u3063\u3066 Pod \u304c\u6e1b\u308b myapp-1871887261 2 2 1 5m # ReplicaSet \u306b\u3088\u3063\u3066 Pod \u304c\u5897\u3048\u308b\u304c ready \u306b\u306f\u306a\u3089\u306a\u3044 myapp-1871887261 2 2 2 7m # 2 \u5206\u305f\u3063\u3066\u3059\u3079\u3066\u304c ready \u306b\u306a\u308b \u53c2\u8003 # Disruptions Specifying a Disruption Budget for your Application DisruptionBudget object to define the max disruption that can be caused to pods #12611 Safely Drain a Node while Respecting Application SLOs PodDisruptionBudget and /eviction subresource #85","title":"Pdb"},{"location":"guides/pdb/#tldr","text":"Node \u3092\u505c\u6b62\u3059\u308b\u305f\u3081\u306b\u306fkubectl drain \u30b3\u30de\u30f3\u30c9\u3092\u5229\u7528\u3057\u3066\u505c\u6b62\u6e96\u5099\u3092\u884c\u3044\u307e\u3059 drain \u306f Node \u3092 Pod \u306e\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u5bfe\u8c61\u304b\u3089\u5916\u3057 (unschedulable \u306b\u8a2d\u5b9a) Node \u4e0a\u306e Pod \u3092\u9000\u53bb\u3055\u305b\u308b\u3053\u3068\u3067\u505c\u6b62\u53ef\u80fd\u306a\u72b6\u614b\u306b\u3057\u307e\u3059 \u3057\u304b\u3057\u8907\u6570\u306e Node \u3092\u505c\u6b62\u3055\u305b\u308b\u5834\u5408\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e Pod \u304c\u4e00\u3064\u3082\u52d5\u4f5c\u3057\u3066\u3044\u306a\u3044\u72b6\u614b (ready \u306a Pod \u304c 0)\u304c\u3042\u308a\u3048\u308b\u306e\u3067\u6ce8\u610f\u304c\u5fc5\u8981\u3067\u3059 PodDisruptionBudget \u3092\u5b9a\u7fa9\u3059\u308b\u3053\u3068\u3067\u5b89\u5168\u306a Pod \u6570\u3092\u4fdd\u3063\u305f\u307e\u307e\u8907\u6570 Node \u306e drain \u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059 \u5b89\u5168\u306a Pod \u6570\u304c\u78ba\u4fdd\u3067\u304d\u308b\u307e\u3067 kubectl drain \u304c Pod \u306e\u9000\u53bb\u3092\u5f85\u3063\u3066\u304f\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059","title":"TL;DR"},{"location":"guides/pdb/#node-pod-kubectl-drain","text":"OS \u306e\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3084\u30b9\u30b1\u30fc\u30eb\u30c0\u30a6\u30f3\u306a\u3069\u3067 Node \u3092\u505c\u6b62\u3057\u305f\u3044\u5834\u5408\u3001\u305d\u306e Node \u306b\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b Pod \u306b\u9000\u53bb\u3057\u3066\u3082\u3089\u3046\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u306e\u64cd\u4f5c\u306f kubctl drain <NODE> \u3068\u3044\u3046\u30b3\u30de\u30f3\u30c9\u3067\u7c21\u5358\u306b\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002 \u4e0b\u8a18\u306e\u3088\u3046\u306b Node \u540d\u3092\u6307\u5b9a\u3057\u3066 kubectl drain \u3092\u5b9f\u884c\u3057\u307e\u3059\u3002 $ kubectl drain --ignore-daemonsets --force gke-cluster-2-default-pool-0fb8a591-71rf # Node \u304c unschedulable \u306b\u8a2d\u5b9a\u3055\u308c\u308b (kubectl cordon \u3068\u540c\u7b49) node \"gke-cluster-2-default-pool-0fb8a591-71rf\" cordoned WARNING: Deleting pods not managed by ReplicationController, ReplicaSet, Job, DaemonSet or StatefulSet: kube-proxy-gke-cluster-2-default-pool-0fb8a591-71rf ; Ignoring DaemonSet-managed pods: fluentd-gcp-v2.0-tt6mf # \u3053\u306e Node \u306b\u3042\u308b Pod \u304c\u9000\u53bb\u3055\u305b\u3089\u308c\u3066\u3044\u304f pod \"myapp-1243928920-bz02h\" evicted pod \"heapster-v1.4.0-1718439912-xmg0k\" evicted # drain \u304c\u5b8c\u4e86 node \"gke-cluster-2-default-pool-0fb8a591-71rf\" drained \u30ce\u30fc\u30c9\u304c\u6b63\u3057\u304f SchedulingDisabled (unschedulable) \u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\u52d5\u4f5c\u4e2d\u306e Pod \u304c\u306a\u304f\u306a\u308a\u3001\u65b0\u305f\u306b Pod \u304c\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3055\u308c\u308b\u3053\u3068\u3082\u306a\u3044\u305f\u3081\u3001\u3053\u306e\u30ce\u30fc\u30c9\u306f\u505c\u6b62\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002 $ kubectl get nodes NAME STATUS AGE VERSION gke-cluster-2-default-pool-0fb8a591-71rf Ready,SchedulingDisabled 20m v1.7.3 # SchedulingDisabled \u306b\u306a\u3063\u305f gke-cluster-2-default-pool-0fb8a591-cmcl Ready 20m v1.7.3 gke-cluster-2-default-pool-0fb8a591-d6pn Ready 20m v1.7.3 gke-cluster-2-default-pool-0fb8a591-n1sr Ready 20m v1.7.3","title":"Node \u304b\u3089 Pod \u3092\u9000\u53bb\u3055\u305b\u308b (kubectl drain)"},{"location":"guides/pdb/#kubectl-drain","text":"kubectl drain \u3067\u306f\u4e3b\u306b\u4ee5\u4e0b\u306e\u51e6\u7406\u304c\u884c\u308f\u308c\u3066\u3044\u307e\u3059\u3002 Node \u306b\u65b0\u898f Pod \u304c\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3055\u308c\u306a\u3044\u3088\u3046\u306b unschedulable \u306e\u8a2d\u5b9a\u3092\u884c\u3046 Node \u306b\u7d10\u4ed8\u3051\u3089\u308c\u3066\u3044\u308b Pod \u4e00\u89a7\u3092\u53d6\u5f97\u3057\u3066\u3001Pod \u7fa4\u306b\u9000\u53bb (evict) \u306e\u51e6\u7406\u304c\u884c\u308f\u308c\u308b \u8a73\u3057\u304f\u306f\u5f8c\u8ff0\u306e Eviction API \u3092\u3054\u89a7\u304f\u3060\u3055\u3044 evict \u304c\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u306a\u3044\u5834\u5408(\u65e7\u30d0\u30fc\u30b8\u30e7\u30f3\u306e API Server \u306a\u3069)\u306f\u5358\u306b\u524a\u9664\u51e6\u7406\u306b\u306a\u308b","title":"kubectl drain \u306e\u52d5\u4f5c"},{"location":"guides/pdb/#_1","text":"\u4f8b\u3048\u3070 Node \u304c 4\u53f0\u3042\u308a\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b myapp \u3068\u3044\u3046\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c 2 \u3064\u306e\u30ce\u30fc\u30c9\u306b\u3042\u308b\u72b6\u614b\u3060\u3068\u3057\u307e\u3059\u3002myapp \u306f ReplicaSet (\u30ec\u30d7\u30ea\u30ab\u6570 2) \u3067\u7ba1\u7406\u3055\u308c\u3066\u3044\u308b\u3068\u3057\u307e\u3059\u3002 node-1 \u306b\u5bfe\u3057\u3066 kubectl drain \u3092\u884c\u3046\u3068\u3001\u4e0b\u8a18\u306e\u3088\u3046\u306a\u9806\u5e8f\u3067\u51e6\u7406\u304c\u884c\u308f\u308c\u307e\u3059\u3002 node-1 \u3092 unschedulrable \u306b\u8a2d\u5b9a node-1 \u306b\u5272\u308a\u5f53\u3066\u3089\u308c\u305f Pod (\u3053\u3053\u3067\u306f myapp-1) \u304c\u9000\u53bb(evict)\u3055\u305b\u3089\u308c\u307e\u3059 PodDisruptionBudget \u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u306a\u3044\u5834\u5408\u3001\u9000\u53bb(evict) \u306f\u5358\u7d14\u306b Pod \u304c\u524a\u9664\u3055\u308c\u307e\u3059 kubectl \u306e drain \u306f\u3053\u3053\u3067\u7d42\u4e86\u3057\u307e\u3059 ReplicaSet \u306e\u50cd\u304d\u306b\u3088\u3063\u3066 node-3 \u306b\u65b0\u305f\u306b Pod \u304c\u4f5c\u6210\u3055\u308c\u3001\u30ec\u30d7\u30ea\u30ab\u6570 2 \u304c\u4fdd\u305f\u308c\u307e\u3059\u3002","title":"\u52d5\u4f5c\u4f8b"},{"location":"guides/pdb/#_2","text":"\u7d9a\u3051\u3066 node-2 \u3092 drain \u3057\u305f\u3044\u5834\u5408\u6ce8\u610f\u304c\u5fc5\u8981\u3067\u3059\u3002\u65b0\u3057\u304f\u4f5c\u6210\u3055\u308c\u305f myapp-3 \u306e Pod \u4f5c\u6210\u306b\u6642\u9593\u304c\u304b\u304b\u3063\u305f\u5834\u5408\u306f\u3001node-2 \u3092 drain \u3059\u308b\u3053\u3068\u306b\u3088\u3063\u3066\u4e00\u3064\u3082 Pod \u304c ready \u306b\u306a\u3063\u3066\u3044\u306a\u3044\u72b6\u6cc1\u304c\u8d77\u3053\u308a\u5f97\u307e\u3059\u3002","title":"\u6ce8\u610f\u304c\u5fc5\u8981\u306a\u5834\u5408"},{"location":"guides/pdb/#poddisruptionbudget-drain","text":"PodDisruptionBudget \u3068\u306f Node \u3092\u8a08\u753b\u7684\u306b\u505c\u6b62\u3057\u305f\u3044\u5834\u5408\u306b\u3001Pod \u306e\u72b6\u6cc1\u3092\u898b\u306a\u304c\u3089\u9000\u53bb (evict) \u3055\u305b\u308b\u6a5f\u80fd\u3067\u3059\u3002\u57fa\u672c\u7684\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306f ReplicaSet \u306b\u3088\u3063\u3066\u8907\u6570\u306e Pod \u304c\u4fdd\u6301\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u5197\u9577\u6027\u304c\u3042\u308b\u3068\u8003\u3048\u3089\u308c\u307e\u3059\u3002PodDisruptionBudget \u306f\u505c\u6b62\u72b6\u614b (Disruption) \u3068\u3057\u3066\u8a31\u5bb9\u3067\u304d\u308b Pod \u6570\u3092\u4e88\u7b97 (Budget) \u3068\u3057\u3066\u5b9a\u7fa9\u3057\u3066\u3001\u305d\u306e\u4e88\u7b97\u5185\u3067\u9000\u53bb\u3055\u305b\u3066\u3044\u304d\u307e\u3059\u3002( Error Budget \u7684\u306a\u540d\u524d\u3067\u6d12\u843d\u3066\u3044\u307e\u3059\u306d)\u3002 PodDiruptionBudget \u3067\u306f\u4ee5\u4e0b\u306e\u3069\u3061\u3089\u304b\u306e\u8a2d\u5b9a\u304c\u53ef\u80fd\u3067\u3059\u3002 .spec.minAvailable : \u5c11\u306a\u304f\u3068\u3082\u6709\u52b9\u3067\u3042\u308b\u3079\u304d Pod \u6570\u3002\u30d1\u30fc\u30bb\u30f3\u30c6\u30fc\u30b8\u306b\u3088\u308b\u6307\u5b9a\u3082\u53ef\u80fd .spec.maxUnavailable : \u6700\u5927\u7121\u52b9\u3067\u3042\u3063\u3066\u3082\u3088\u3044 Pod \u6570\u3002\u30d1\u30fc\u30bb\u30f3\u30c6\u30fc\u30b8\u306b\u3088\u308b\u6307\u5b9a\u3082\u53ef\u80fd (v1.7 \u4ee5\u4e0a\u3067\u5229\u7528\u53ef\u80fd) \u4ee5\u4e0b\u306e\u3088\u3046\u306b PodDisruptionBudget \u30ea\u30bd\u30fc\u30b9\u3092\u5b9a\u7fa9\u3057\u3066\u5229\u7528\u3057\u307e\u3059\u3002 kubectl create poddisruptionbudget \u3068\u3044\u3046\u30b5\u30d6\u30b3\u30de\u30f3\u30c9\u306b\u3088\u308b\u4f5c\u6210\u3082\u53ef\u80fd\u3067\u3059\u3002 apiVersion : policy/v1beta1 kind : PodDisruptionBudget metadata : name : myapp spec : # \u6700\u5927\u3067\u7121\u52b9\u72b6\u614b\u306a Pod \u306f 1 \u306b\u8a2d\u5b9a\u3002\u3053\u308c\u3092\u8d85\u3048\u3066\u306f\u9000\u53bb\u3055\u305b\u3089\u308c\u306a\u3044 maxUnavailable : 1 # \u5bfe\u8c61 Pod \u306e\u30bb\u30ec\u30af\u30bf selector : matchLabels : run : myapp \u3053\u308c\u3092\u8a2d\u5b9a\u3059\u308b\u3068\u524d\u8ff0\u306e\u4f8b\u306e Node-2 \u306e\u9000\u53bb\u306f\u4ee5\u4e0b\u306e\u52d5\u4f5c\u306b\u306a\u308a\u307e\u3059\u3002 node-2 \u3092 unschedulrable \u306b\u8a2d\u5b9a node-2 \u306b\u5272\u308a\u5f53\u3066\u3089\u308c\u305f Pod (\u3053\u3053\u3067\u306f myapp-1) \u3092\u9000\u53bb(evict)\u3057\u3088\u3046\u3068\u3059\u308b \u3059\u3067\u306b unavailable \u306e Pod \u304c\u3042\u308a PodDisruptionBudget \u3092\u8d85\u3048\u3066\u3057\u307e\u3046\u305f\u3081\u9000\u53bb\u3092\u5f85\u3061\u307e\u3059 (5 \u79d2\u9593\u9694\u3067\u30ea\u30c8\u30e9\u30a4) node-3 \u306e Pod \u304c ready \u306b\u306a\u308a PodDisruptionBudget \u3092\u6e80\u305f\u3059\u3088\u3046\u306b\u306a\u308b\u3068 node-2 \u306e Pod \u306f\u524a\u9664\u3055\u308c\u307e\u3059\u3002","title":"PodDisruptionBudget \u306b\u3088\u308b\u5b89\u5168\u306a drain"},{"location":"guides/pdb/#poddisruptionbudget","text":"PodDisruptionBudget \u30ea\u30bd\u30fc\u30b9\u306b\u306f\u7ba1\u7406\u3055\u308c\u3066\u3044\u308b Pod \u306e\u72b6\u614b\u304c\u8a18\u8ff0\u3055\u308c\u3066\u3044\u307e\u3059\u3002 kubectl get pdb \u3067\u8a2d\u5b9a\u72b6\u6cc1\u3068\u73fe\u5728\u505c\u6b62\u304c\u8a31\u5bb9\u3055\u308c\u308b Pod \u6570 ( ALLOWED-DISRUPTIONS ) \u3092\u898b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002 $ kubectl get pdb NAME MIN-AVAILABLE MAX-UNAVAILABLE ALLOWED-DISRUPTIONS AGE myapp N/A 1 1 2m \u8a73\u7d30\u306a\u72b6\u6cc1\u306f\u4e0b\u8a18\u306e\u3088\u3046\u306b\u898b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002 $ kubectl get pdb -o yaml myapp apiVersion : policy/v1beta1 kind : PodDisruptionBudget metadata : annotations : kubectl.kubernetes.io/last-applied-configuration : | {\"apiVersion\":\"policy/v1beta1\",\"kind\":\"PodDisruptionBudget\",\"metadata\":{\"annotations\":{},\"name\":\"myapp\",\"namespace\":\"default\"},\"spec\":{\"maxUnavailable\":1,\"selector\":{\"matchLabels\":{\"run\":\"myapp\"}}}} creationTimestamp : 2017-08-28T07:53:13Z generation : 1 name : myapp namespace : default resourceVersion : \"8859\" selfLink : /apis/policy/v1beta1/namespaces/default/poddisruptionbudgets/myapp uid : f14ed83b-8bc5-11e7-862c-42010af00125 spec : maxUnavailable : 1 selector : matchLabels : run : myapp status : # ready \u72b6\u614b\u306e Pod \u6570 currentHealthy : 10 # \u3053\u306e\u6570\u3092\u4e0b\u56de\u3063\u3066\u306f Evicton \u3067\u304d\u306a\u3044 desiredHealthy : 9 disruptedPods : null # \u73fe\u5728\u505c\u6b62\u304c\u8a31\u3055\u308c\u308b Pod \u6570\u3002currentHealthy - desiredHealthy \u3067\u8a08\u7b97\u3055\u308c\u308b disruptionsAllowed : 1 expectedPods : 10 observedGeneration : 1","title":"PodDisruptionBudget \u306e\u72b6\u6cc1\u3092\u898b\u308b"},{"location":"guides/pdb/#eviction-api","text":"kubectl drain \u3067\u306f\u5185\u90e8\u7684\u306b\u306f Pod \u306e\u524a\u9664(DELETE)\u3067\u306f\u306a\u304f\u3001Eviction API \u3068\u3044\u3046 Pod \u306e\u30b5\u30d6\u30ea\u30bd\u30fc\u30b9\u3092\u547c\u3073\u51fa\u3057\u3066 Node \u306b\u7d10\u3065\u304f Pod \u306e\u9000\u907f\u3092\u884c\u3063\u3066\u3044\u307e\u3059\u3002Pod \u306e\u524a\u9664\u3068\u306e\u9055\u3044\u306f PodDiruptionBudget \u3092\u53c2\u7167\u3057\u4e88\u7b97\u3092\u6e80\u305f\u3055\u306a\u3044\u5834\u5408\u306f\u524a\u9664\u305b\u305a\u306b 429 Too Many Requests \u3092\u8fd4\u3059\u70b9\u3067\u3059\u3002 Eviction \u30b5\u30d6\u30ea\u30bd\u30fc\u30b9\u306f Pod \u306e\u30b5\u30d6\u30ea\u30bd\u30fc\u30b9\u3068\u3057\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002 /api/v1/namespaces/<NAMESPACE>/pods/<POD>/eviction \u3053\u306e API \u306b\u5bfe\u3057\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306a Eviction \u30b5\u30d6\u30ea\u30bd\u30fc\u30b9 \u3092 POST \u3057\u307e\u3059\u3002 { \"kind\" : \"Eviction\" , \"apiVersion\" : \"policy/v1beta1\" , \"metadata\" : { \"name\" : \"myapp-1243928920-bz02h\" , # POD \u540d \"namespace\" : \"default\" , \"creationTimestamp\" : null }, \"deleteOptions\" : {} } Eviction API \u306f PodDiruptionBudget \u3092\u53c2\u7167\u3057\u3001\u5b9a\u7fa9\u3057\u305f\u4e88\u7b97\u3092\u6e80\u305f\u3057\u3066\u3044\u308b\u5834\u5408\u306f Pod \u306e\u524a\u9664\u3057\u3066 HTTP \u306e 201 Created \u3001\u6e80\u305f\u3057\u3066\u3044\u306a\u3044\u5834\u5408\u306f\u524a\u9664\u305b\u305a HTTP \u306e 429 Too Many Requests \u3092\u8fd4\u3057\u307e\u3059\u3002 # kubectl \u306e verbose \u30ed\u30b0 I0828 14 :12:38.049411 29825 round_trippers.go:405 ] POST https://35.194.250.38/api/v1/namespaces/default/pods/myapp-1243928920-cpmcr/eviction 429 Too Many Requests in 39 milliseconds kubectl drain \u3067\u306f 429 Too Many Requests \u306e\u3068\u304d\u306f 5 \u79d2\u3054\u3068\u306b\u30ea\u30c8\u30e9\u30a4\u3059\u308b\u5b9f\u88c5\u306b\u306a\u3063\u3066\u304a\u308a\u3001\u4e88\u7b97\u3092\u6e80\u305f\u3059\u304b\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8( --timeout \u306e\u5024)\u306b\u306a\u308b\u307e\u3067\u5f85\u3061\u7d9a\u3051\u307e\u3059\u3002(\u53c2\u8003: drain.go#L500 )","title":"\u88dc\u8db3: Eviction (\u9000\u907f) API"},{"location":"guides/pdb/#poddisruptionbudget_1","text":"PodDisruptionBudget \u3092\u5b9f\u969b\u306b\u8a66\u3057\u3066\u307f\u307e\u3059\u3002\u3053\u3053\u3067\u306f ready \u306b\u306a\u308b\u307e\u3067\u306b\u6642\u9593\u304c\u304b\u304b\u308b(2\u5206)\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u30c7\u30d7\u30ed\u30a4\u3057\u3001maxUnavailable \u3092 1 \u306b\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002( \u4f7f\u7528\u3057\u305f Deployment \u3068 PodDisruptionBudget \u306e\u30de\u30cb\u30d5\u30a7\u30b9\u30c8 )\u3002\u4e0b\u8a18\u306e\u3088\u3046\u306b Pod \u304c 2 \u3064\u306e Node \u306b\u30c7\u30d7\u30ed\u30a4\u3055\u308c\u3066\u3044\u308b\u72b6\u614b\u304b\u3089\u59cb\u3081\u307e\u3059\u3002Node \u306f\u5168\u4f53\u3067 4 \u3064\u3042\u308a\u307e\u3059\u3002 $ kubectl get pods -o wide NAME READY STATUS RESTARTS AGE IP NODE myapp-1871887261-k5v4s 1 /1 Running 0 2m 10 .8.0.7 gke-cluster-1-default-pool-94337df7-lnc5 myapp-1871887261-x23z5 1 /1 Running 0 2m 10 .8.2.6 gke-cluster-1-default-pool-94337df7-sfp4 Pod \u304c\u30c7\u30d7\u30ed\u30a4\u3055\u308c\u3066\u3044\u308b 2 Node \u306b\u5bfe\u3057\u3066\u540c\u6642\u306b drain \u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002 $ kubectl drain --ignore-daemonsets --force gke-cluster-1-default-pool-94337df7-lnc5 $ kubectl drain --ignore-daemonsets --force gke-cluster-1-default-pool-94337df7-sfp4 ReplicaSet \u3092 watch \u3057\u3066 drain \u4e2d\u306e Pod \u306e\u72b6\u614b\u3092\u898b\u3066\u307e\u3059\u3002\u60f3\u5b9a\u3069\u304a\u308a PodDisruptionBudget \u306e\u304a\u304b\u3052\u3067 ready \u306e Pod \u304c\u5e38\u306b\u3042\u308b\u72b6\u614b\u3092\u4fdd\u3063\u3066\u3044\u307e\u3059\u3002Node \u306e\u4e00\u3064\u306f drain \u304c\u3059\u3050\u306b\u7d42\u308f\u308a\u3001\u3082\u3046\u4e00\u3064\u306e Node \u306f drain \u304c PodDisruptionBudget \u3067\u5b9a\u7fa9\u3057\u305f Pod \u306eready \u3092\u5f85\u3064\u305f\u3081\u306b\u7d04 2 \u5206\u9593\u304b\u304b\u308a\u307e\u3057\u305f\u3002 # DESIRED : ReplicaSet \u3067\u5b9a\u7fa9\u3057\u305f\u30ec\u30d7\u30ea\u30ab\u6570 # CURRENT : Pod \u6570 (\u30b9\u30c6\u30fc\u30bf\u30b9\u306f\u95a2\u4fc2\u306a\u3057) # READY : ready \u72b6\u614b\u306e Pod \u6570 $ kubectl get rs -w NAME DESIRED CURRENT READY AGE myapp-1871887261 2 2 2 3m # drain \u5b9f\u884c\u524d myapp-1871887261 2 1 1 3m # \u3072\u3068\u3064\u3081\u306e Node \u306e drain \u306b\u3088\u3063\u3066 Pod \u304c\u6e1b\u308b myapp-1871887261 2 2 1 3m # ReplicaSet \u306b\u3088\u3063\u3066 Pod \u304c\u5897\u3048\u308b\u304c ready \u306b\u306f\u306a\u3089\u306a\u3044 # ready \u3092\u5f85\u3064\u305f\u3081\u306b\u3053\u3053\u3067\u7d04 2\u5206\u9593\u304b\u304b\u308b myapp-1871887261 2 2 2 5m # 2 \u3064ready \u306b\u306a\u3063\u305f\u306e\u3067 \u3075\u305f\u3064\u3081\u306e Node \u3082 drain \u3067\u304d\u308b myapp-1871887261 2 1 1 5m # \u3075\u305f\u3064\u3081\u306e Node \u306e drain \u306b\u3088\u3063\u3066 Pod \u304c\u6e1b\u308b myapp-1871887261 2 2 1 5m # ReplicaSet \u306b\u3088\u3063\u3066 Pod \u304c\u5897\u3048\u308b\u304c ready \u306b\u306f\u306a\u3089\u306a\u3044 myapp-1871887261 2 2 2 7m # 2 \u5206\u305f\u3063\u3066\u3059\u3079\u3066\u304c ready \u306b\u306a\u308b","title":"PodDisruptionBudget \u306e\u52d5\u4f5c\u3092\u8a66\u3057\u3066\u307f\u308b"},{"location":"guides/pdb/#_3","text":"Disruptions Specifying a Disruption Budget for your Application DisruptionBudget object to define the max disruption that can be caused to pods #12611 Safely Drain a Node while Respecting Application SLOs PodDisruptionBudget and /eviction subresource #85","title":"\u53c2\u8003"},{"location":"guides/when-to-use-google-kubernetes-engine-vs-cloud-run-for-containers/","text":"Source GKE \u3068 Cloud Run\u3001\u3069\u3046\u4f7f\u3044\u5206\u3051\u308b\u3079\u304d\u304b | Google Cloud Blog # \u203b\u3053\u306e\u6295\u7a3f\u306f\u7c73\u56fd\u6642\u9593 2019 \u5e74 11 \u6708 23 \u65e5\u306b\u3001Google Cloud blog \u306b \u6295\u7a3f \u3055\u308c\u305f\u3082\u306e\u306e\u6284\u8a33\u3067\u3059\u3002 \u9ad8\u5ea6\u306a\u30b9\u30b1\u30fc\u30e9\u30d3\u30ea\u30c6\u30a3\u3068\u69cb\u6210\u306e\u67d4\u8edf\u6027\u3092\u63d0\u4f9b\u3059\u308b\u30b3\u30f3\u30c6\u30ca \u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3 \u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u3092\u6c42\u3081\u3066\u3044\u308b\u304a\u5ba2\u69d8\u306b\u3068\u3063\u3066\u3001\u30de\u30cd\u30fc\u30b8\u30c9 Kubernetes \u30b5\u30fc\u30d3\u30b9\u3067\u3042\u308b Google Kubernetes Engine \uff08GKE\uff09\u306f\u512a\u308c\u305f\u9078\u629e\u80a2\u306b\u306a\u308a\u307e\u3059\u3002GKE \u306f\u3001\u30b9\u30c6\u30fc\u30c8\u30d5\u30eb \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30b5\u30dd\u30fc\u30c8\u306b\u52a0\u3048\u3066\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30ad\u30f3\u30b0\u3001\u30b9\u30c8\u30ec\u30fc\u30b8\u3001\u30aa\u30d6\u30b6\u30fc\u30d0\u30d3\u30ea\u30c6\u30a3\uff08\u53ef\u89b3\u6e2c\u6027\uff09\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u306a\u3069\u3001\u30b3\u30f3\u30c6\u30ca \u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\u306e\u3042\u3089\u3086\u308b\u5074\u9762\u3092\u5b8c\u5168\u306b\u5236\u5fa1\u3067\u304d\u307e\u3059\u3002 \u3057\u304b\u3057\u306a\u304c\u3089\u3001\u304a\u4f7f\u3044\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u305d\u3046\u3057\u305f\u30ec\u30d9\u30eb\u306e\u30af\u30e9\u30b9\u30bf\u69cb\u6210\u3084\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0\u3092\u5fc5\u8981\u3068\u3057\u306a\u3044\u5834\u5408\u306f\u3001\u30d5\u30eb\u30de\u30cd\u30fc\u30b8\u30c9\u306e Cloud Run \u304c\u6700\u9069\u306a\u30bd\u30ea\u30e5\u30fc\u30b7\u30e7\u30f3\u306b\u306a\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\u30d5\u30eb\u30de\u30cd\u30fc\u30b8\u30c9 Cloud Run \u306f\u3001Kubernetes \u306e\u540d\u524d\u7a7a\u9593\u3001\u30dd\u30c3\u30c9\u3067\u306e\u30b3\u30f3\u30c6\u30ca\u5171\u5b58\uff08\u30b5\u30a4\u30c9\u30ab\u30fc\uff09\u3001\u30ce\u30fc\u30c9\u306e\u5272\u308a\u5f53\u3066\u3084\u7ba1\u7406\u3068\u3044\u3063\u305f\u6a5f\u80fd\u3092\u5fc5\u8981\u3068\u3057\u306a\u3044\u30b3\u30f3\u30c6\u30ca\u5316\u3055\u308c\u305f\u30b9\u30c6\u30fc\u30c8\u30ec\u30b9 \u30de\u30a4\u30af\u30ed\u30b5\u30fc\u30d3\u30b9\u306b\u3046\u3063\u3066\u3064\u3051\u306e \u30b5\u30fc\u30d0\u30fc\u30ec\u30b9 \u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0 \u3067\u3059\u3002 \u306a\u305c Cloud Run \u306a\u306e\u304b # \u30de\u30cd\u30fc\u30b8\u30c9 \u30b5\u30fc\u30d0\u30fc\u30ec\u30b9 \u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0 \u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u3067\u3042\u308b Cloud Run \u306f\u3001\u3055\u307e\u3056\u307e\u306a\u6a5f\u80fd\u3084\u30e1\u30ea\u30c3\u30c8\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002 **\u30de\u30a4\u30af\u30ed\u30b5\u30fc\u30d3\u30b9\u306e\u5bb9\u6613\u306a\u30c7\u30d7\u30ed\u30a4 : **\u30b3\u30f3\u30c6\u30ca\u5316\u3055\u308c\u305f\u30de\u30a4\u30af\u30ed\u30b5\u30fc\u30d3\u30b9\u3092\u30b7\u30f3\u30b0\u30eb \u30b3\u30de\u30f3\u30c9\u3067\u30c7\u30d7\u30ed\u30a4\u3067\u304d\u3001\u30b5\u30fc\u30d3\u30b9\u56fa\u6709\u306e\u69cb\u6210\u306f\u4e0d\u8981\u3067\u3059\u3002 **\u30b7\u30f3\u30d7\u30eb\u3067\u7d71\u4e00\u7684\u306a\u30c7\u30d9\u30ed\u30c3\u30d1\u30fc \u30a8\u30af\u30b9\u30da\u30ea\u30a8\u30f3\u30b9 : **\u5404\u30de\u30a4\u30af\u30ed\u30b5\u30fc\u30d3\u30b9\u306f\u3001Cloud Run \u306e\u30c7\u30d7\u30ed\u30a4\u5358\u4f4d\u3067\u3042\u308b Docker \u30a4\u30e1\u30fc\u30b8\u3068\u3057\u3066\u5b9f\u88c5\u3055\u308c\u307e\u3059\u3002 **\u30b9\u30b1\u30fc\u30e9\u30d6\u30eb\u306a\u30b5\u30fc\u30d0\u30fc\u30ec\u30b9\u5b9f\u884c : **\u30de\u30cd\u30fc\u30b8\u30c9 Cloud Run \u306b\u30c7\u30d7\u30ed\u30a4\u3055\u308c\u308b\u30de\u30a4\u30af\u30ed\u30b5\u30fc\u30d3\u30b9\u306f\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u6570\u306b\u5fdc\u3058\u3066\u81ea\u52d5\u7684\u306b\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u3057\u307e\u3059\u3002\u672c\u683c\u7684\u306a Kubernetes \u30af\u30e9\u30b9\u30bf\u306e\u69cb\u6210\u3084\u7ba1\u7406\u306f\u4e0d\u8981\u3067\u3059\u3002\u30de\u30cd\u30fc\u30b8\u30c9 Cloud Run \u306f\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u306a\u3044\u5834\u5408\u306f\u30bc\u30ed\u306b\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u3057\u3001\u30ea\u30bd\u30fc\u30b9\u3092\u4f7f\u7528\u3057\u307e\u305b\u3093\u3002 **\u4efb\u610f\u306e\u8a00\u8a9e\u3067\u66f8\u304b\u308c\u305f\u30b3\u30fc\u30c9\u306e\u30b5\u30dd\u30fc\u30c8 : **Cloud Run \u306f\u30b3\u30f3\u30c6\u30ca\u3092\u30d9\u30fc\u30b9\u3068\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u4efb\u610f\u306e\u8a00\u8a9e\u3067\u30b3\u30fc\u30c9\u3092\u4f5c\u6210\u3067\u304d\u3001\u4efb\u610f\u306e\u30d0\u30a4\u30ca\u30ea\u3084\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3092\u4f7f\u7528\u3067\u304d\u307e\u3059\u3002 Cloud Run \u306f 2 \u3064\u306e\u69cb\u6210 \u3067\u5229\u7528\u3067\u304d\u307e\u3059\u3002\u30d5\u30eb\u30de\u30cd\u30fc\u30b8\u30c9\u306e Google Cloud \u30b5\u30fc\u30d3\u30b9\u3068\u3057\u3066\u3001\u305d\u3057\u3066 Cloud Run for Anthos \u3068\u3057\u3066\u3067\u3059\uff08\u5f8c\u8005\u3067\u306f Cloud Run \u3092 Anthos GKE \u30af\u30e9\u30b9\u30bf\u306b\u30c7\u30d7\u30ed\u30a4\u3057\u307e\u3059\uff09\u3002\u3059\u3067\u306b Anthos \u3092\u304a\u4f7f\u3044\u306e\u5834\u5408\u306f\u3001Cloud Run for Anthos \u3067 \u30b3\u30f3\u30c6\u30ca\u3092\u304a\u5ba2\u69d8\u306e\u30af\u30e9\u30b9\u30bf\u306b\u30c7\u30d7\u30ed\u30a4 \u3057\u3001\u30ab\u30b9\u30bf\u30e0 \u30de\u30b7\u30f3\u30bf\u30a4\u30d7\u3084\u9ad8\u5ea6\u306a\u30cd\u30c3\u30c8\u30ef\u30fc\u30ad\u30f3\u30b0 \u30b5\u30dd\u30fc\u30c8\u3001GPU \u3092\u5229\u7528\u3057\u3066\u3001Cloud Run \u30b5\u30fc\u30d3\u30b9\u3092\u5f37\u5316\u3067\u304d\u307e\u3059\u3002\u30de\u30cd\u30fc\u30b8\u30c9 Cloud Run \u30b5\u30fc\u30d3\u30b9\u3068 GKE \u30af\u30e9\u30b9\u30bf\u306f\u3001\u3044\u305a\u308c\u3082\u30b3\u30f3\u30bd\u30fc\u30eb\u3068\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u306e\u4e21\u65b9\u304b\u3089\u5b8c\u5168\u306b\u4f5c\u6210\u3001\u7ba1\u7406\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002 \u3057\u304b\u3082\u3001\u4fbf\u5229\u306a\u3053\u3068\u306b\u3001\u30de\u30cd\u30fc\u30b8\u30c9 Cloud Run \u3068 Cloud Run for Anthos \u306f\u3001\u30b5\u30fc\u30d3\u30b9\u3092\u5b9f\u88c5\u3057\u76f4\u3059\u3053\u3068\u306a\u304f\u3001\u5f8c\u3067\u65b9\u91dd\u3092\u5909\u3048\u3066\u76f8\u4e92\u306b\u7c21\u5358\u306b\u5207\u308a\u66ff\u3048\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002 Cloud Run \u306e\u30e6\u30fc\u30b9 \u30b1\u30fc\u30b9 # \u4ee5\u4e0a\u306e\u70b9\u3092\u5177\u4f53\u7684\u306b\u7406\u89e3\u3057\u3066\u3044\u305f\u3060\u304f\u305f\u3081\u306b\u3001\u30e6\u30fc\u30b9 \u30b1\u30fc\u30b9\u306e\u4f8b\u3068\u3057\u3066\u3001\u30a2\u30c9\u30ec\u30b9\u306e\u8ffd\u52a0\u3001\u66f4\u65b0\u3001\u524a\u9664\u3001\u4e00\u89a7\u8868\u793a\u3092\u884c\u3046\u30b5\u30fc\u30d3\u30b9\u3092\u898b\u3066\u307f\u307e\u3057\u3087\u3046\u3002 \u3053\u306e\u30a2\u30c9\u30ec\u30b9\u7ba1\u7406\u30b5\u30fc\u30d3\u30b9\u3092\u5b9f\u88c5\u3059\u308b\u306b\u306f\u3001\u305d\u308c\u305e\u308c\u306e\u64cd\u4f5c\u3054\u3068\u306b\u3001\u30b3\u30f3\u30c6\u30ca\u5316\u3055\u308c\u305f\u30de\u30a4\u30af\u30ed\u30b5\u30fc\u30d3\u30b9\u3092 1 \u3064\u4f5c\u6210\u3057\u307e\u3059\u3002\u305d\u3057\u3066\u3001\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\u3057\u3066\u30b3\u30f3\u30c6\u30ca \u30ec\u30b8\u30b9\u30c8\u30ea\u306b\u767b\u9332\u3057\u305f\u3089\u3001\u30b7\u30f3\u30b0\u30eb \u30b3\u30de\u30f3\u30c9\u3067\u30de\u30cd\u30fc\u30b8\u30c9 Cloud Run \u306b\u30c7\u30d7\u30ed\u30a4\u3067\u304d\u307e\u3059\u30024 \u3064\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\uff08\u5404\u30de\u30a4\u30af\u30ed\u30b5\u30fc\u30d3\u30b9\u3092 1 \u3064\u305a\u3064\u30c7\u30d7\u30ed\u30a4\uff09\u3001\u5b8c\u5168\u306b\u30b5\u30fc\u30d0\u30fc\u30ec\u30b9\u306a\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u3067\u30b5\u30fc\u30d3\u30b9\u304c\u7a3c\u50cd\u3057\u307e\u3059\u3002\u4e0b\u306e\u56f3\u306f\u3001\u57fa\u76e4\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3068\u3057\u3066 Cloud Spanner \u3092\u4f7f\u3063\u305f\u30c7\u30d7\u30ed\u30a4\u3092\u793a\u3057\u3066\u3044\u307e\u3059\u3002","title":"When to use google kubernetes engine vs cloud run for containers"},{"location":"guides/when-to-use-google-kubernetes-engine-vs-cloud-run-for-containers/#gke-cloud-run-google-cloud-blog","text":"\u203b\u3053\u306e\u6295\u7a3f\u306f\u7c73\u56fd\u6642\u9593 2019 \u5e74 11 \u6708 23 \u65e5\u306b\u3001Google Cloud blog \u306b \u6295\u7a3f \u3055\u308c\u305f\u3082\u306e\u306e\u6284\u8a33\u3067\u3059\u3002 \u9ad8\u5ea6\u306a\u30b9\u30b1\u30fc\u30e9\u30d3\u30ea\u30c6\u30a3\u3068\u69cb\u6210\u306e\u67d4\u8edf\u6027\u3092\u63d0\u4f9b\u3059\u308b\u30b3\u30f3\u30c6\u30ca \u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3 \u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u3092\u6c42\u3081\u3066\u3044\u308b\u304a\u5ba2\u69d8\u306b\u3068\u3063\u3066\u3001\u30de\u30cd\u30fc\u30b8\u30c9 Kubernetes \u30b5\u30fc\u30d3\u30b9\u3067\u3042\u308b Google Kubernetes Engine \uff08GKE\uff09\u306f\u512a\u308c\u305f\u9078\u629e\u80a2\u306b\u306a\u308a\u307e\u3059\u3002GKE \u306f\u3001\u30b9\u30c6\u30fc\u30c8\u30d5\u30eb \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30b5\u30dd\u30fc\u30c8\u306b\u52a0\u3048\u3066\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30ad\u30f3\u30b0\u3001\u30b9\u30c8\u30ec\u30fc\u30b8\u3001\u30aa\u30d6\u30b6\u30fc\u30d0\u30d3\u30ea\u30c6\u30a3\uff08\u53ef\u89b3\u6e2c\u6027\uff09\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u306a\u3069\u3001\u30b3\u30f3\u30c6\u30ca \u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\u306e\u3042\u3089\u3086\u308b\u5074\u9762\u3092\u5b8c\u5168\u306b\u5236\u5fa1\u3067\u304d\u307e\u3059\u3002 \u3057\u304b\u3057\u306a\u304c\u3089\u3001\u304a\u4f7f\u3044\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u305d\u3046\u3057\u305f\u30ec\u30d9\u30eb\u306e\u30af\u30e9\u30b9\u30bf\u69cb\u6210\u3084\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0\u3092\u5fc5\u8981\u3068\u3057\u306a\u3044\u5834\u5408\u306f\u3001\u30d5\u30eb\u30de\u30cd\u30fc\u30b8\u30c9\u306e Cloud Run \u304c\u6700\u9069\u306a\u30bd\u30ea\u30e5\u30fc\u30b7\u30e7\u30f3\u306b\u306a\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\u30d5\u30eb\u30de\u30cd\u30fc\u30b8\u30c9 Cloud Run \u306f\u3001Kubernetes \u306e\u540d\u524d\u7a7a\u9593\u3001\u30dd\u30c3\u30c9\u3067\u306e\u30b3\u30f3\u30c6\u30ca\u5171\u5b58\uff08\u30b5\u30a4\u30c9\u30ab\u30fc\uff09\u3001\u30ce\u30fc\u30c9\u306e\u5272\u308a\u5f53\u3066\u3084\u7ba1\u7406\u3068\u3044\u3063\u305f\u6a5f\u80fd\u3092\u5fc5\u8981\u3068\u3057\u306a\u3044\u30b3\u30f3\u30c6\u30ca\u5316\u3055\u308c\u305f\u30b9\u30c6\u30fc\u30c8\u30ec\u30b9 \u30de\u30a4\u30af\u30ed\u30b5\u30fc\u30d3\u30b9\u306b\u3046\u3063\u3066\u3064\u3051\u306e \u30b5\u30fc\u30d0\u30fc\u30ec\u30b9 \u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0 \u3067\u3059\u3002","title":"GKE \u3068 Cloud Run\u3001\u3069\u3046\u4f7f\u3044\u5206\u3051\u308b\u3079\u304d\u304b | Google Cloud Blog"},{"location":"guides/when-to-use-google-kubernetes-engine-vs-cloud-run-for-containers/#cloud-run","text":"\u30de\u30cd\u30fc\u30b8\u30c9 \u30b5\u30fc\u30d0\u30fc\u30ec\u30b9 \u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0 \u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u3067\u3042\u308b Cloud Run \u306f\u3001\u3055\u307e\u3056\u307e\u306a\u6a5f\u80fd\u3084\u30e1\u30ea\u30c3\u30c8\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002 **\u30de\u30a4\u30af\u30ed\u30b5\u30fc\u30d3\u30b9\u306e\u5bb9\u6613\u306a\u30c7\u30d7\u30ed\u30a4 : **\u30b3\u30f3\u30c6\u30ca\u5316\u3055\u308c\u305f\u30de\u30a4\u30af\u30ed\u30b5\u30fc\u30d3\u30b9\u3092\u30b7\u30f3\u30b0\u30eb \u30b3\u30de\u30f3\u30c9\u3067\u30c7\u30d7\u30ed\u30a4\u3067\u304d\u3001\u30b5\u30fc\u30d3\u30b9\u56fa\u6709\u306e\u69cb\u6210\u306f\u4e0d\u8981\u3067\u3059\u3002 **\u30b7\u30f3\u30d7\u30eb\u3067\u7d71\u4e00\u7684\u306a\u30c7\u30d9\u30ed\u30c3\u30d1\u30fc \u30a8\u30af\u30b9\u30da\u30ea\u30a8\u30f3\u30b9 : **\u5404\u30de\u30a4\u30af\u30ed\u30b5\u30fc\u30d3\u30b9\u306f\u3001Cloud Run \u306e\u30c7\u30d7\u30ed\u30a4\u5358\u4f4d\u3067\u3042\u308b Docker \u30a4\u30e1\u30fc\u30b8\u3068\u3057\u3066\u5b9f\u88c5\u3055\u308c\u307e\u3059\u3002 **\u30b9\u30b1\u30fc\u30e9\u30d6\u30eb\u306a\u30b5\u30fc\u30d0\u30fc\u30ec\u30b9\u5b9f\u884c : **\u30de\u30cd\u30fc\u30b8\u30c9 Cloud Run \u306b\u30c7\u30d7\u30ed\u30a4\u3055\u308c\u308b\u30de\u30a4\u30af\u30ed\u30b5\u30fc\u30d3\u30b9\u306f\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u6570\u306b\u5fdc\u3058\u3066\u81ea\u52d5\u7684\u306b\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u3057\u307e\u3059\u3002\u672c\u683c\u7684\u306a Kubernetes \u30af\u30e9\u30b9\u30bf\u306e\u69cb\u6210\u3084\u7ba1\u7406\u306f\u4e0d\u8981\u3067\u3059\u3002\u30de\u30cd\u30fc\u30b8\u30c9 Cloud Run \u306f\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u306a\u3044\u5834\u5408\u306f\u30bc\u30ed\u306b\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u3057\u3001\u30ea\u30bd\u30fc\u30b9\u3092\u4f7f\u7528\u3057\u307e\u305b\u3093\u3002 **\u4efb\u610f\u306e\u8a00\u8a9e\u3067\u66f8\u304b\u308c\u305f\u30b3\u30fc\u30c9\u306e\u30b5\u30dd\u30fc\u30c8 : **Cloud Run \u306f\u30b3\u30f3\u30c6\u30ca\u3092\u30d9\u30fc\u30b9\u3068\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u4efb\u610f\u306e\u8a00\u8a9e\u3067\u30b3\u30fc\u30c9\u3092\u4f5c\u6210\u3067\u304d\u3001\u4efb\u610f\u306e\u30d0\u30a4\u30ca\u30ea\u3084\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3092\u4f7f\u7528\u3067\u304d\u307e\u3059\u3002 Cloud Run \u306f 2 \u3064\u306e\u69cb\u6210 \u3067\u5229\u7528\u3067\u304d\u307e\u3059\u3002\u30d5\u30eb\u30de\u30cd\u30fc\u30b8\u30c9\u306e Google Cloud \u30b5\u30fc\u30d3\u30b9\u3068\u3057\u3066\u3001\u305d\u3057\u3066 Cloud Run for Anthos \u3068\u3057\u3066\u3067\u3059\uff08\u5f8c\u8005\u3067\u306f Cloud Run \u3092 Anthos GKE \u30af\u30e9\u30b9\u30bf\u306b\u30c7\u30d7\u30ed\u30a4\u3057\u307e\u3059\uff09\u3002\u3059\u3067\u306b Anthos \u3092\u304a\u4f7f\u3044\u306e\u5834\u5408\u306f\u3001Cloud Run for Anthos \u3067 \u30b3\u30f3\u30c6\u30ca\u3092\u304a\u5ba2\u69d8\u306e\u30af\u30e9\u30b9\u30bf\u306b\u30c7\u30d7\u30ed\u30a4 \u3057\u3001\u30ab\u30b9\u30bf\u30e0 \u30de\u30b7\u30f3\u30bf\u30a4\u30d7\u3084\u9ad8\u5ea6\u306a\u30cd\u30c3\u30c8\u30ef\u30fc\u30ad\u30f3\u30b0 \u30b5\u30dd\u30fc\u30c8\u3001GPU \u3092\u5229\u7528\u3057\u3066\u3001Cloud Run \u30b5\u30fc\u30d3\u30b9\u3092\u5f37\u5316\u3067\u304d\u307e\u3059\u3002\u30de\u30cd\u30fc\u30b8\u30c9 Cloud Run \u30b5\u30fc\u30d3\u30b9\u3068 GKE \u30af\u30e9\u30b9\u30bf\u306f\u3001\u3044\u305a\u308c\u3082\u30b3\u30f3\u30bd\u30fc\u30eb\u3068\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u306e\u4e21\u65b9\u304b\u3089\u5b8c\u5168\u306b\u4f5c\u6210\u3001\u7ba1\u7406\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002 \u3057\u304b\u3082\u3001\u4fbf\u5229\u306a\u3053\u3068\u306b\u3001\u30de\u30cd\u30fc\u30b8\u30c9 Cloud Run \u3068 Cloud Run for Anthos \u306f\u3001\u30b5\u30fc\u30d3\u30b9\u3092\u5b9f\u88c5\u3057\u76f4\u3059\u3053\u3068\u306a\u304f\u3001\u5f8c\u3067\u65b9\u91dd\u3092\u5909\u3048\u3066\u76f8\u4e92\u306b\u7c21\u5358\u306b\u5207\u308a\u66ff\u3048\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002","title":"\u306a\u305c Cloud Run \u306a\u306e\u304b"},{"location":"guides/when-to-use-google-kubernetes-engine-vs-cloud-run-for-containers/#cloud-run_1","text":"\u4ee5\u4e0a\u306e\u70b9\u3092\u5177\u4f53\u7684\u306b\u7406\u89e3\u3057\u3066\u3044\u305f\u3060\u304f\u305f\u3081\u306b\u3001\u30e6\u30fc\u30b9 \u30b1\u30fc\u30b9\u306e\u4f8b\u3068\u3057\u3066\u3001\u30a2\u30c9\u30ec\u30b9\u306e\u8ffd\u52a0\u3001\u66f4\u65b0\u3001\u524a\u9664\u3001\u4e00\u89a7\u8868\u793a\u3092\u884c\u3046\u30b5\u30fc\u30d3\u30b9\u3092\u898b\u3066\u307f\u307e\u3057\u3087\u3046\u3002 \u3053\u306e\u30a2\u30c9\u30ec\u30b9\u7ba1\u7406\u30b5\u30fc\u30d3\u30b9\u3092\u5b9f\u88c5\u3059\u308b\u306b\u306f\u3001\u305d\u308c\u305e\u308c\u306e\u64cd\u4f5c\u3054\u3068\u306b\u3001\u30b3\u30f3\u30c6\u30ca\u5316\u3055\u308c\u305f\u30de\u30a4\u30af\u30ed\u30b5\u30fc\u30d3\u30b9\u3092 1 \u3064\u4f5c\u6210\u3057\u307e\u3059\u3002\u305d\u3057\u3066\u3001\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\u3057\u3066\u30b3\u30f3\u30c6\u30ca \u30ec\u30b8\u30b9\u30c8\u30ea\u306b\u767b\u9332\u3057\u305f\u3089\u3001\u30b7\u30f3\u30b0\u30eb \u30b3\u30de\u30f3\u30c9\u3067\u30de\u30cd\u30fc\u30b8\u30c9 Cloud Run \u306b\u30c7\u30d7\u30ed\u30a4\u3067\u304d\u307e\u3059\u30024 \u3064\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\uff08\u5404\u30de\u30a4\u30af\u30ed\u30b5\u30fc\u30d3\u30b9\u3092 1 \u3064\u305a\u3064\u30c7\u30d7\u30ed\u30a4\uff09\u3001\u5b8c\u5168\u306b\u30b5\u30fc\u30d0\u30fc\u30ec\u30b9\u306a\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u3067\u30b5\u30fc\u30d3\u30b9\u304c\u7a3c\u50cd\u3057\u307e\u3059\u3002\u4e0b\u306e\u56f3\u306f\u3001\u57fa\u76e4\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3068\u3057\u3066 Cloud Spanner \u3092\u4f7f\u3063\u305f\u30c7\u30d7\u30ed\u30a4\u3092\u793a\u3057\u3066\u3044\u307e\u3059\u3002","title":"Cloud Run \u306e\u30e6\u30fc\u30b9 \u30b1\u30fc\u30b9"},{"location":"overview/","text":"index #","title":"index"},{"location":"overview/#index","text":"","title":"index"},{"location":"references/kubernetes/","text":"Kubernetes # Cluster components # The terms that are typically used to describe cluster components could be confusing, so in an effort to clarify things, here's a schema of the most important ones, and their definition. CPU # A Central Processing Unit (CPU), or core, or CPU core, is the smallest unit in a microprocessor that can carry out computational tasks, that is, run programs. Modern processors typically have multiple cores. Socket # A socket is the connector that houses the microprocessor. By extension, it represents the physical package of a processor, that typically contains multiple cores. Node # A node is a physical, stand-alone computer, that can handle computing tasks and run jobs. It's connected to other compute nodes via a fast network interconnect, and contains CPUs, memory and devices managed by an operating system. Cluster # A cluster is the complete collection of nodes with networking and file storage facilities. It's usually a group of independent computers connected via a fast network interconnect, managed by a resource manager, which acts as a large parallel computer. Other commonly used terms # To make this documentation more accessible, we try to explain key terms in a non-technical way. When reading these pages, please keep in mind the following definitions, presented in alphabetical order: Application # An application is a computer program designed to perform a group of coordinated functions, tasks, or activities for the benefit of the user. In the context of scientific computing, an application typically performs computations related to a scientific goal (molecular dynamics simulations, genome assembly, compuational fluid dynamics simulations, etc). Backfill # Backfill scheduling is a method that a scheduler can use in order to maximize utilization. It allows smaller (both in terms of size and time requirements), lower priority jobs to start before larger, higher priority ones, as long as doing so doesn't push back the higher-priority jobs expected start time. Executable # A binary (or executable) program refers to the machine-code compiled version of an application. This is which is a binary file that a computer can execute directly. As opposed to the application source code, which is the human-readable version of the application internal instructions, and which needs to be compiled by a compiler to produce the executable binary. Fairshare # A resource scheduler ranks jobs by priority for execution. Each job's priority in queue is determined by multiple factors, among which one being the user's fairshare score. A user's fairshare score is computed based on a target (the given portion of the resources that this user should be able to use) and the user's effetive usage, ie the amount of resources (s)he effectively used in the past. As a result, the more resources past jobs have used, the lower the priority of the next jobs will be. Past usage is computed based on a sliding window and progressively forgotten over time. This enables all users on a shared resource to get a fair portion of it for their own use, by giving higher priorty to users who have been underserved in the past. FLOPS # Floating-point Operations Per Second (FLOPS) are a measure of computing performance, and represent the number of floating-point operations that a CPU can perform each second. Modern CPUs and GPUs are capable of doing TeraFLOPS (10^12 floating-point operations per second), depending on the precision of those operations (half-precision: 16 bits, single-precision: 32 bits, double-precision: 64 bits). GPU # A Graphical Processing Unit (GPU) is a specialized device initially designed to generate graphical output. On modern computing architecture, they are used to accelerate certain types of computation, which they are much faster than CPUs at. GPUs have their own memory, and are attached to CPUs, within a node. Each compute node can host one or more GPUs. HPC # High Performance Computing (HPC) refers to the practice of aggregating computing power to achieve higher performance that would be possible by using a typical computer. Infiniband # Infiniband is a networking standard that features high bandwidth and low latency. The current Infiniband devices are capable of transferring data at up to 100 Gbits/sec with less than a microsecond latency. As of this writing, the popular Infiniband versions are FDR (Fourteen Data Rate) with 56 Gbits/sec and EDR (Enhanced Data Rate) with 100 Gbits/sec. IOPS # Input/output operations per second (IOPS, pronounced eye-ops) is an input/output performance measurement used to characterize computer storage system performance. Job # A job, or batch job, is the scheduler\u2019s base unit of computing by which resources are allocated to a user for a specified amount of time. Users create job submission scripts to ask the scheduler for resources such as cores, memory, runtime, etc. The scheduler puts the requests in a queue and allocates requested resources based on jobs\u2019 priority. Job step # Job steps are sets of (possibly parallel) tasks within a job Login nodes # Login nodes are points of access to a compute cluster. Users usually connect to login nodes via SSH to compile and debug their code, review their results, do some simple tests, and submit their batch jobs to the parallel computer. Login nodes are not for computing Login nodes are usually shared among many users and therefore must not be used to run computationally intensive tasks. Those should be submitted to the scheduler which will dispatch them on compute nodes. Modules # Environment modules, or software modules, are a type of software management tool used on in most HPC environments. Using modules enable users to selectively pick the software that they want to use and add them to their environment. This allows to switch between different versions or flavors of the same software, pick compilers, libraries and software components and avoid conflicts between them. MPI # Message Passing Interface (MPI) is a standardized and portable message-passing system designed to exchange information between processes running on different nodes. There are several implementations of the MPI standard, which is the most common way used to scale parallel applications beyond a single compute node. OpenMP # Open Multi Processing (OpenMP) is a parallel programming model designed for shared memory architecture. It's based on pragmas that can be added in applications to let the compiler generate a code that can run on multiple cores, within the same node. Partition # A partition is a set of compute nodes within a cluster with a common feature. For example, compute nodes with GPU, or compute nodes belonging to same owner, could form a partition. QOS # A Quality Of Service (QOS) is the set of rules and limitations that apply to a categories of job. The combination of a partition (set of machines where a job can run) and QOS (set of rules that applies to that job) makes what is often referred to as a scheduler queue . Run time # The run time, or walltime, of a job is the time required to finish its execution. Scheduler # The goal of a job scheduler is to find the appropriate resources to run a set of computational tasks in the most efficient manner. Based on resource requirements and job descriptions, it will prioritize those jobs, allocate resources (nodes, CPUs, memory) and schedule their execution. Slurm # Simple Linux Utility for Resource Management (SLURM) is a software that manages computing resources and schedule tasks on them. Slurm coordinates running of many programs on a shared facility and makes sure that resources are used in an optimal manner. SSH # Secure Shell (SSH) is a protocol to securely access remote computers. Based on the client-server model, multiple users with an SSH client can access a remote computer. Some operating systems such as Linux and Mac OS have a built-in SSH client and others can use one of many publicly available clients. Thread # A process, in the simplest terms, is an executing program. One or more threads run in the context of the process. A thread is the basic unit to which the operating system allocates processor time. A thread can execute any part of the process code, including parts currently being executed by another thread. Threads are co-located on the same node. Task # In the Slurm context, a task is to be understood as a process. A multi-process program is made of several tasks. A task is typically used to schedule a MPI process, that in turn can use several CPUs. By contrast, a multi-threaded program is composed of only one task, which uses several CPUs 1 . hogehoge \u21a9","title":"Kubernetes"},{"location":"references/kubernetes/#kubernetes","text":"","title":"Kubernetes"},{"location":"references/kubernetes/#cluster-components","text":"The terms that are typically used to describe cluster components could be confusing, so in an effort to clarify things, here's a schema of the most important ones, and their definition.","title":"Cluster components"},{"location":"references/kubernetes/#cpu","text":"A Central Processing Unit (CPU), or core, or CPU core, is the smallest unit in a microprocessor that can carry out computational tasks, that is, run programs. Modern processors typically have multiple cores.","title":"CPU"},{"location":"references/kubernetes/#socket","text":"A socket is the connector that houses the microprocessor. By extension, it represents the physical package of a processor, that typically contains multiple cores.","title":"Socket"},{"location":"references/kubernetes/#node","text":"A node is a physical, stand-alone computer, that can handle computing tasks and run jobs. It's connected to other compute nodes via a fast network interconnect, and contains CPUs, memory and devices managed by an operating system.","title":"Node"},{"location":"references/kubernetes/#cluster","text":"A cluster is the complete collection of nodes with networking and file storage facilities. It's usually a group of independent computers connected via a fast network interconnect, managed by a resource manager, which acts as a large parallel computer.","title":"Cluster"},{"location":"references/kubernetes/#other-commonly-used-terms","text":"To make this documentation more accessible, we try to explain key terms in a non-technical way. When reading these pages, please keep in mind the following definitions, presented in alphabetical order:","title":"Other commonly used terms"},{"location":"references/kubernetes/#application","text":"An application is a computer program designed to perform a group of coordinated functions, tasks, or activities for the benefit of the user. In the context of scientific computing, an application typically performs computations related to a scientific goal (molecular dynamics simulations, genome assembly, compuational fluid dynamics simulations, etc).","title":"Application"},{"location":"references/kubernetes/#backfill","text":"Backfill scheduling is a method that a scheduler can use in order to maximize utilization. It allows smaller (both in terms of size and time requirements), lower priority jobs to start before larger, higher priority ones, as long as doing so doesn't push back the higher-priority jobs expected start time.","title":"Backfill"},{"location":"references/kubernetes/#executable","text":"A binary (or executable) program refers to the machine-code compiled version of an application. This is which is a binary file that a computer can execute directly. As opposed to the application source code, which is the human-readable version of the application internal instructions, and which needs to be compiled by a compiler to produce the executable binary.","title":"Executable"},{"location":"references/kubernetes/#fairshare","text":"A resource scheduler ranks jobs by priority for execution. Each job's priority in queue is determined by multiple factors, among which one being the user's fairshare score. A user's fairshare score is computed based on a target (the given portion of the resources that this user should be able to use) and the user's effetive usage, ie the amount of resources (s)he effectively used in the past. As a result, the more resources past jobs have used, the lower the priority of the next jobs will be. Past usage is computed based on a sliding window and progressively forgotten over time. This enables all users on a shared resource to get a fair portion of it for their own use, by giving higher priorty to users who have been underserved in the past.","title":"Fairshare"},{"location":"references/kubernetes/#flops","text":"Floating-point Operations Per Second (FLOPS) are a measure of computing performance, and represent the number of floating-point operations that a CPU can perform each second. Modern CPUs and GPUs are capable of doing TeraFLOPS (10^12 floating-point operations per second), depending on the precision of those operations (half-precision: 16 bits, single-precision: 32 bits, double-precision: 64 bits).","title":"FLOPS"},{"location":"references/kubernetes/#gpu","text":"A Graphical Processing Unit (GPU) is a specialized device initially designed to generate graphical output. On modern computing architecture, they are used to accelerate certain types of computation, which they are much faster than CPUs at. GPUs have their own memory, and are attached to CPUs, within a node. Each compute node can host one or more GPUs.","title":"GPU"},{"location":"references/kubernetes/#hpc","text":"High Performance Computing (HPC) refers to the practice of aggregating computing power to achieve higher performance that would be possible by using a typical computer.","title":"HPC"},{"location":"references/kubernetes/#infiniband","text":"Infiniband is a networking standard that features high bandwidth and low latency. The current Infiniband devices are capable of transferring data at up to 100 Gbits/sec with less than a microsecond latency. As of this writing, the popular Infiniband versions are FDR (Fourteen Data Rate) with 56 Gbits/sec and EDR (Enhanced Data Rate) with 100 Gbits/sec.","title":"Infiniband"},{"location":"references/kubernetes/#iops","text":"Input/output operations per second (IOPS, pronounced eye-ops) is an input/output performance measurement used to characterize computer storage system performance.","title":"IOPS"},{"location":"references/kubernetes/#job","text":"A job, or batch job, is the scheduler\u2019s base unit of computing by which resources are allocated to a user for a specified amount of time. Users create job submission scripts to ask the scheduler for resources such as cores, memory, runtime, etc. The scheduler puts the requests in a queue and allocates requested resources based on jobs\u2019 priority.","title":"Job"},{"location":"references/kubernetes/#job-step","text":"Job steps are sets of (possibly parallel) tasks within a job","title":"Job step"},{"location":"references/kubernetes/#login-nodes","text":"Login nodes are points of access to a compute cluster. Users usually connect to login nodes via SSH to compile and debug their code, review their results, do some simple tests, and submit their batch jobs to the parallel computer. Login nodes are not for computing Login nodes are usually shared among many users and therefore must not be used to run computationally intensive tasks. Those should be submitted to the scheduler which will dispatch them on compute nodes.","title":"Login nodes"},{"location":"references/kubernetes/#modules","text":"Environment modules, or software modules, are a type of software management tool used on in most HPC environments. Using modules enable users to selectively pick the software that they want to use and add them to their environment. This allows to switch between different versions or flavors of the same software, pick compilers, libraries and software components and avoid conflicts between them.","title":"Modules"},{"location":"references/kubernetes/#mpi","text":"Message Passing Interface (MPI) is a standardized and portable message-passing system designed to exchange information between processes running on different nodes. There are several implementations of the MPI standard, which is the most common way used to scale parallel applications beyond a single compute node.","title":"MPI"},{"location":"references/kubernetes/#openmp","text":"Open Multi Processing (OpenMP) is a parallel programming model designed for shared memory architecture. It's based on pragmas that can be added in applications to let the compiler generate a code that can run on multiple cores, within the same node.","title":"OpenMP"},{"location":"references/kubernetes/#partition","text":"A partition is a set of compute nodes within a cluster with a common feature. For example, compute nodes with GPU, or compute nodes belonging to same owner, could form a partition.","title":"Partition"},{"location":"references/kubernetes/#qos","text":"A Quality Of Service (QOS) is the set of rules and limitations that apply to a categories of job. The combination of a partition (set of machines where a job can run) and QOS (set of rules that applies to that job) makes what is often referred to as a scheduler queue .","title":"QOS"},{"location":"references/kubernetes/#run-time","text":"The run time, or walltime, of a job is the time required to finish its execution.","title":"Run time"},{"location":"references/kubernetes/#scheduler","text":"The goal of a job scheduler is to find the appropriate resources to run a set of computational tasks in the most efficient manner. Based on resource requirements and job descriptions, it will prioritize those jobs, allocate resources (nodes, CPUs, memory) and schedule their execution.","title":"Scheduler"},{"location":"references/kubernetes/#slurm","text":"Simple Linux Utility for Resource Management (SLURM) is a software that manages computing resources and schedule tasks on them. Slurm coordinates running of many programs on a shared facility and makes sure that resources are used in an optimal manner.","title":"Slurm"},{"location":"references/kubernetes/#ssh","text":"Secure Shell (SSH) is a protocol to securely access remote computers. Based on the client-server model, multiple users with an SSH client can access a remote computer. Some operating systems such as Linux and Mac OS have a built-in SSH client and others can use one of many publicly available clients.","title":"SSH"},{"location":"references/kubernetes/#thread","text":"A process, in the simplest terms, is an executing program. One or more threads run in the context of the process. A thread is the basic unit to which the operating system allocates processor time. A thread can execute any part of the process code, including parts currently being executed by another thread. Threads are co-located on the same node.","title":"Thread"},{"location":"references/kubernetes/#task","text":"In the Slurm context, a task is to be understood as a process. A multi-process program is made of several tasks. A task is typically used to schedule a MPI process, that in turn can use several CPUs. By contrast, a multi-threaded program is composed of only one task, which uses several CPUs 1 . hogehoge \u21a9","title":"Task"}]}